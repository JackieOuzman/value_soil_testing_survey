---
title: "Survey data analysis"
author: "Jackie Ouzman and Belinda Stummer"
date: "22/08/2019"
output:
  html_document:
    df_print: paged
  
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#install.packages("dplyr")
library(dplyr)
library(tidyverse)
library(ggplot2)
library(readxl)
library(DT)
#install.packages("scales")
library(scales)
#install.packages("formattable")
#install.packages("data.table")
library(data.table)
#library(formattable)
```

#### General notes 

* Note I have made some adjustment to the heading names in the excel sheet - many questions don't have numbers.
* I have used survey script to get the order correct.

```{r import dataset advisor, include=FALSE}

#These names are very long perhaps we can make them shorter?



headers <- read_excel("Nutrient Management Survey_Agrononomist09092019.xlsx", 
                   sheet = "Data", col_names=FALSE, range = "A1:HL1")
data <- read_excel("Nutrient Management Survey_Agrononomist09092019.xlsx", 
                   sheet = "Data", col_names=FALSE, range = "A5:HL174")
names(data) <- headers
```



```{r setting up the region names and order, include=FALSE}

table(data$Q_1)
data <- mutate(data,
             names_display =case_when(
               Q_1 == "SA - Mallee (low rainfall)" ~  "SA - Mallee",
               Q_1 == "SA – Lower EP (medium rainfall)" ~  "SA – Lower EP",
               Q_1 == "SA - Mid North (medium rainfall)" ~  "SA - Mid North",
               Q_1 == "SA - Yorke Peninsula (medium rainfall)" ~  "SA - Yorke Peninsula",
               Q_1 == "SA - Upper EP (low rainfall)" ~  "SA - Upper EP",
               Q_1 == "SA - South East (medium rainfall)" ~  "SA - South East",
               Q_1 == "VIC - Wimmera (medium rainfall)" ~  "VIC - Wimmera",
               Q_1 == "VIC - Mallee (low rainfall)" ~  "VIC - Mallee",
               Q_1 == "VIC - Southern region (high rainfall)" ~  "VIC - Southern region",
               Q_1 == "Other (please specify)" ~  "Other"))


data <- mutate(data, names_display = fct_relevel(names_display, c("SA - Mallee", 
                                       "SA – Lower EP", 
                                       "SA - Mid North", 
                                       "SA - Yorke Peninsula", 
                                       "SA - Upper EP", 
                                       "SA - South East", 
                                       "VIC - Wimmera",
                                       "VIC - Mallee",
                                       "VIC - Southern region",
                                       "Other")))

data <- mutate(data,
             region_merge =case_when(
               Q_1 == "SA - Mallee (low rainfall)" ~  "SA - Mallee",
               Q_1 == "SA – Lower EP (medium rainfall)" ~  "SA – EP",
               Q_1 == "SA - Mid North (medium rainfall)" ~  "SA - Mid North",
               Q_1 == "SA - Yorke Peninsula (medium rainfall)" ~  "SA - Yorke Peninsula",
               Q_1 == "SA - Upper EP (low rainfall)" ~  "SA – EP",
               Q_1 == "SA - South East (medium rainfall)" ~  "SA - South East",
               Q_1 == "VIC - Wimmera (medium rainfall)" ~  "VIC - Wimmera",
               Q_1 == "VIC - Mallee (low rainfall)" ~  "VIC - Mallee",
               Q_1 == "VIC - Southern region (high rainfall)" ~  "VIC - Southern region",
               Q_1 == "Other (please specify)" ~  "Other"))

data <- mutate(data, region_merge = fct_relevel(region_merge, c("SA - Mallee", 
                                       "SA – EP", 
                                       "SA - Mid North", 
                                       "SA - Yorke Peninsula", 
                                       
                                       "SA - South East", 
                                       "VIC - Wimmera",
                                       "VIC - Mallee",
                                       "VIC - Southern region",
                                       "Other")))


```





```{r setting up the states and rainfall, include=FALSE}


data <- mutate(data,
             states =case_when(
               Q_1 == "SA - Mallee (low rainfall)" ~  "SA",
               Q_1 == "SA – Lower EP (medium rainfall)" ~  "SA",
               Q_1 == "SA - Mid North (medium rainfall)" ~  "SA",
               Q_1 == "SA - Yorke Peninsula (medium rainfall)" ~  "SA",
               Q_1 == "SA - Upper EP (low rainfall)" ~  "SA",
               Q_1 == "SA - South East (medium rainfall)" ~  "SA",
               Q_1 == "VIC - Wimmera (medium rainfall)" ~  "VIC",
               Q_1 == "VIC - Mallee (low rainfall)" ~  "VIC",
               Q_1 == "VIC - Southern region (high rainfall)" ~  "VIC",
               Q_1 == "Other (please specify)" ~  "Other"))

data <- mutate(data, states = fct_relevel(states, c("SA", "VIC", "Other")))


data <- mutate(data,
             rainfall =case_when(
               Q_1 == "SA - Mallee (low rainfall)" ~  "low rainfall",
               Q_1 == "SA – Lower EP (medium rainfall)" ~  "medium rainfall",
               Q_1 == "SA - Mid North (medium rainfall)" ~  "medium rainfall",
               Q_1 == "SA - Yorke Peninsula (medium rainfall)" ~  "medium rainfall",
               Q_1 == "SA - Upper EP (low rainfall)" ~  "low rainfall",
               Q_1 == "SA - South East (medium rainfall)" ~  "medium rainfall",
               Q_1 == "VIC - Wimmera (medium rainfall)" ~  "medium rainfall",
               Q_1 == "VIC - Mallee (low rainfall)" ~  "low rainfall",
               Q_1 == "VIC - Southern region (high rainfall)" ~  "high rainfall",
               Q_1 == "Other (please specify)" ~  "Other"))

data <- mutate(data, rainfall = fct_relevel(rainfall, c("low rainfall", "medium rainfall", "high rainfall")))
```



#### **The first series of questions looks at your current farming practices.**


#### **Question 1** 

Agronomist) 

In which argo-ecological region do you work / are your clients based?

Grower) 

In which agro-ecological region do you farm?


```{r Q1 analysis and table, echo=FALSE}
#both agro and growers
Q1_resp_percent <- data %>% 
  count(Resp_Group) %>% 
  mutate(percent = 
           (freq = n / sum(n)))
#table
datatable(Q1_resp_percent, 
          options = list(pageLength = 35, dom = 't'),
  colnames = c('Respondent' = 'Resp_Group')) %>%
  formatPercentage('percent', 1) 


####graph
ggplot(Q1_resp_percent, aes(Resp_Group, percent, fill = Resp_Group))+
  geom_col()+
  scale_fill_manual(values=c("grey70", "grey40"))+
  theme_classic()+
  theme(legend.position = "none")+
  labs(x= "",
       y = "percentage of all respondents",
       fill = "",
       title = "",
       subtitle = "Survey respondents")+
       #caption = "Agronomist and Growers")+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(size = 8)) + 
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L))   
 
```

##### **Question 1 by region** 
 
 
```{r Q1_by agro analysis and table, echo=FALSE}

#split into agro and growers
Q1_agro_region_perc <- filter(data, Resp_Group == "Agronomist") %>% 
  count( names_display) %>% 
  mutate(percent = round(
           (freq = n / sum(n)),2))

# datatable(Q1_agro_region_perc, colnames = c('Region' = 'names_display')) %>%
#   formatPercentage('percent', 0) 

#graph
ggplot(Q1_agro_region_perc, aes(names_display, percent ))+
  geom_col(fill = "grey70", color = "black")+
  theme_classic()+
  labs(x= "Regions",
       y = "Agronomist",
       fill = "",
       title = "",
       subtitle = "Survey respondents per region",
       caption = "")+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(size = 8)) + 
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L), limits = c(0, .6))    

```


```{r Q2_by growers analysis and table, echo=FALSE}

#split into agro and growers
Q1_grower_region_perc <- filter(data, Resp_Group == "Grower") %>% 
  count( names_display) %>% 
  mutate(percent = round( 
           (freq = n / sum(n)),2))

#table
#print(Q1_grower_region_perc)
#datatable(Q1_grower_region_perc, colnames = c( "regions", "count", "percentage"), caption = "Respondents per region - Grower")


#graph growers per region
ggplot(Q1_grower_region_perc, aes(names_display, percent ))+
  geom_col(fill = "grey40", color = "black")+
  theme_classic()+
  labs(x= "Regions",
       y = "Growers",
       fill = "",
       title = "",
       subtitle = "Survey respondents per region",
       caption = "")+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(size = 8)) + 
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L), limits = c(0, .6))    

```

#### **Question 1 by merged EP region** 


```{r Q1_by agro and grower by mergered region, echo=FALSE}

#split into agro and growers
Q1_agro_region_mereged_perc <- filter(data, Resp_Group == "Agronomist") %>% 
  count( region_merge) %>% 
  mutate(percent = round(
           (freq = n / sum(n)),2))


#graph
ggplot(Q1_agro_region_mereged_perc, aes(region_merge, percent ))+
  geom_col(fill = "grey70", color = "black")+
  #geom_text(aes(label = percent(signif(percent),1), vjust = -1.0, hjust = 0.5))+
  theme_classic()+
  labs(x= "Regions merged",
       y = "Agronomist",
       fill = "",
       title = "",
       subtitle = "Survey respondents per region",
       caption = "")+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(size = 8)) + 
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L), limits = c(0,0.6))  


#split into agro and growers
Q1_grower_region_mereged_perc <- filter(data, Resp_Group == "Grower") %>% 
  count( region_merge) %>% 
  mutate(percent = round(
           (freq = n / sum(n)),2))


#graph
ggplot(Q1_grower_region_mereged_perc, aes(region_merge, percent ))+
  geom_col(fill = "grey40", color = "black")+
  #geom_text(aes(label = percent(signif(percent),1), vjust = -1.0, hjust = 0.5))+
  theme_classic()+
  labs(x= "Regions merged",
       y = "Grower",
       fill = "",
       title = "",
       subtitle = "Survey respondents per region",
       caption = "")+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(size = 8)) + 
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L), limits = c(0,0.6))    

```


```{r Q2_by agro by states analysis and table, echo=FALSE}

#split into agro and growers
Q1_agro_state_perc <- filter(data, Resp_Group == "Agronomist") %>% 
  count( states) %>% 
  mutate(percent = round( 
           (freq = n / sum(n)),2))

Q1_grower_state_perc <- filter(data, Resp_Group == "Grower") %>% 
  count( states) %>% 
  mutate(percent = round( 
           (freq = n / sum(n)),2))



#graph agro per region
ggplot(Q1_agro_state_perc, aes(states, percent ))+
  geom_col(fill = "grey70", color = "black")+
  theme_classic()+
  labs(x= "States",
       y = "Agronomist",
       fill = "",
       title = "",
       subtitle = "Survey respondents per state",
       caption = "")+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(size = 8)) + 
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L), limits = c(0,0.6))

#graph growers per region
ggplot(Q1_grower_state_perc, aes(states, percent ))+
  geom_col(fill = "grey40", color = "black")+
  theme_classic()+
  labs(x= "States",
       y = "Growers",
       fill = "",
       title = "",
       subtitle = "Survey respondents per state",
       caption = "")+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(size = 8)) + 
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L), limits = c(0,0.6))

```



```{r Q2_by agro by rainfall analysis and table, echo=FALSE}

#split into agro and growers
Q1_agro_rainfall_perc <- filter(data, Resp_Group == "Agronomist") %>% 
  count( rainfall) %>% 
  mutate(percent = round( 
           (freq = n / sum(n)),2))

Q1_grower_rainfall_perc <- filter(data, Resp_Group == "Grower") %>% 
  count( rainfall) %>% 
  mutate(percent = round( 
           (freq = n / sum(n)),2))



#graph agro per region
ggplot(Q1_agro_rainfall_perc, aes(rainfall, percent ))+
  geom_col(fill = "grey70", color = "black")+
  theme_classic()+
  labs(x= "",
       y = "Agronomist",
       fill = "",
       title = "",
       subtitle = "Survey respondents per rainfall zone",
       caption = "")+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(size = 8)) + 
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L), limits = c(0,0.6))

#graph growers per region
ggplot(Q1_grower_rainfall_perc, aes(rainfall, percent ))+
  geom_col(fill = "grey40", color = "black")+
  theme_classic()+
  labs(x= "",
       y = "Growers",
       fill = "",
       title = "",
       subtitle = "Survey respondents per rainfall zone",
       caption = "")+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(size = 8)) + 
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L), limits = c(0,0.6))

```

#### **Comments notes on Question 1** 

* We have more grower(99) respondents than agronomist (71)
* For the growers by region we have some very low responses rates for certain regions (e.g. lower EP).
  This regional grouping (for growers) cannot be used as is, we will need to be merged regions are to reflect regional differences.
* I have added a merged region with EP upper and lower added together.



#### **Question 2** 
What is the average total area cropped (hectares) that you have managed for clients over the last 3 seasons?
Some confusion over how an agronomist could interpret this question.
Therefore we have only displayed the grower response rate


```{r Q2 analysis and table, echo=FALSE}
Q2_regions <-
  filter(data, Resp_Group == "Grower") %>%
  group_by(names_display) %>%
  summarise(count = n(),
            Ave_Cropped_Area = round(mean(`Q_2`), 0)) %>%
  arrange(names_display)



```


```{r Q2 graph regions, eval=FALSE, include=FALSE}
ggplot(Q2_regions, aes(names_display, Ave_Cropped_Area))+
  geom_col()+
  theme_classic()+
  labs(x= "Regions",
       y = "ha",
       title = "Total area cropped",
       subtitle = "Agronomist and grower",
       caption = "Q)  What is your average total area cropped (hectares, including lease etc) over the last 3 seasons?")+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(size = 8)) +
  scale_y_continuous(labels =  comma)
```

**Question 2 by regions** 

```{r Q2 graph regions agro only, echo=FALSE}
#head(data)

# Q2_regions_agro_grower <- group_by(data, names_display, Resp_Group) %>% 
#   summarise(
#     count = n(),
#     Ave_Cropped_Area = round(mean(`Q_2`), 0)) %>% 
#     arrange(names_display)

#head(Q2_regions_agro_grower)

Q2_regions_agro_grower <-
  filter(data, Resp_Group == "Grower") %>%
  group_by(names_display) %>%
  summarise(count = n(),
            Ave_Cropped_Area = round(mean(`Q_2`), 0)) %>%
  arrange(names_display)

ggplot(Q2_regions_agro_grower, aes(names_display, Ave_Cropped_Area))+
  geom_col()+
  scale_fill_manual(values=c("grey70", "grey40"))+
  #facet_wrap(.~ Resp_Group)+
  theme_classic()+
  theme(legend.position = "none")+
  labs(x= "Regions",
       y = "ha",
       title = "Total area cropped - Grower",
       subtitle = "",
       caption = "Q)  What is your average total area cropped (hectares, including lease etc) over the last 3 seasons?")+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(size = 8)) +
  scale_y_continuous(labels =  comma)

```

**Question 2 by regions merged** 



```{r Q2 graph regions merged agro only, echo=FALSE}


# Q2_regions_merged_agro_grower <- group_by(data, region_merge, Resp_Group) %>% 
#   summarise(
#     count = n(),
#     Ave_Cropped_Area = round(mean(`Q_2`), 0))
    
#Q2_regions_merged_agro_grower

Q2_regions_merged_agro_grower <-
  filter(data, Resp_Group == "Grower") %>%
  group_by(region_merge) %>%
  summarise(count = n(),
            Ave_Cropped_Area = round(mean(`Q_2`), 0)) 

ggplot(Q2_regions_merged_agro_grower, aes(region_merge, Ave_Cropped_Area ))+
  geom_col()+
  scale_fill_manual(values=c("grey70", "grey40"))+
  #facet_wrap(.~ Resp_Group)+
  theme_classic()+
  theme(legend.position = "none")+
  labs(x= "Regions",
       y = "ha",
       title = "Total area cropped - Grower (merged EP)",
       subtitle = "",
       caption = "Q)  What is your average total area cropped (hectares, including lease etc) over the last 3 seasons?")+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(size = 8)) +
  scale_y_continuous(labels =  comma)

```

**Question 2** 


```{r Q2 graph agro_grower, echo=FALSE}


Q2_agro_grower <- group_by(data, Resp_Group) %>% 
  summarise(
    count = n(),
    Ave_Cropped_Area = round(mean(`Q_2`), 0)) 


#head(Q2_agro_grower)
datatable(Q2_agro_grower, 
          options = list(pageLength = 35, dom = 't'),
          colnames = c( "Respondents", "count", "Average cropped area"))



ggplot(Q2_agro_grower, aes(Resp_Group, Ave_Cropped_Area, fill = Resp_Group))+
  geom_col()+
  scale_fill_manual(values=c("grey70", "grey40"))+
  theme_classic()+
  labs(x= "",
       y = "Cropped area",
       title = "Total area cropped (hectares)",
       subtitle = "",
       caption = "Q)  What is your average total area cropped (hectares, including lease etc) over the last 3 seasons?")+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(size = 8), legend.position = "none") +
  scale_y_continuous(labels =  comma)
```

#### **Comments notes on Question 2** 

* Total area of copping land is very different for agronomist compared to growers.
* Can't combine the data for this - perhaps indicates a pattern for the whole study (combining the two groups, growers with agronomist should be done with caution).
* Belinda Cay has added a farm size grouping for this question, her farms size grouping is:

* 0-1,000
* 1,000  - 5,000
* 5,000  - 10,000
* 10,000 - 20,000
* 20,000 - 30,000
* 30,000 - 40,000
* 40,000 - 50,000
* 50,000 - 100,000

* Agronomist manage on average 16,402ha while growers 27,97ha.
* Growers in the EP (lower and upper) manage much larger farms as do growers in the mid north, note that Lower EP growers had a low response rate.

#### **Question 3** 

Which of the following crops do you grow - percentage by area?
 

(please enter a whole number without the % sign. Every row needs a number, so if there is none grown, please enter 0.)

3.1 Cereals (wheat, barley, oats)

3.2 Canola

3.3 Pulses (peas, beans, lupins, lentils, chickpeas)

3.4 Pasture

3.5 Hay

3.6 Fallow

```{r Q3 workingregions agro only, include=FALSE}



data <- mutate(data,  area_cereal = Q_2 * (Q_3.1/100), 
                      area_canola = Q_2 * (Q_3.2/100),
                      area_pulses = Q_2 * (Q_3.3/100),
                      area_pasture = Q_2 * (Q_3.4/100),
                      area_hay = Q_2 * (Q_3.5/100),
                      area_fallow = Q_2 * (Q_3.6/100)
               )


Q3_regions_grower <- filter(data, Resp_Group == "Grower") %>% 
  group_by(Resp_Group) %>% 
  summarise(
    Ave_ceral = round(mean(area_cereal), 0),
    Ave_canola = round(mean(area_canola), 0),
    Ave_pulse = round(mean(area_pulses), 0),
    Ave_pasture = round(mean(area_pasture), 0),
    Ave_hay = round(mean(area_hay), 0),
    Ave_fallow = round(mean(area_fallow), 0)
  )
Q3_regions_grower


Q3_regions_grower_narrow <- gather(Q3_regions_grower, 
                                        key = "crop", value = "ave_area",Ave_ceral:Ave_fallow )
Q3_regions_grower_narrow
Q3_regions_grower_narrow <- mutate(Q3_regions_grower_narrow, 
                                        crop = fct_relevel(crop, c("Ave_ceral" , "Ave_canola" , "Ave_pulse" ,
                                                                   "Ave_pasture" , "Ave_hay" , "Ave_fallow" )))

head(Q3_regions_grower_narrow, 40)

```

```{r Q3 graph regions agro only, include=FALSE,  echo=FALSE}
ggplot(Q3_regions_grower_narrow, aes(x = crop, y = ave_area, fill = Resp_Group ))+
  geom_col()+
  scale_fill_manual(values=c( "grey40"))+
  facet_wrap(.~ Resp_Group)+
  theme_classic()+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(hjust = 0), legend.position = "none") +
  
  scale_x_discrete("crop", labels=c("Cereal","Canola", "Pulse", "Pasture","Hay", "Fallow"))+
  labs(x= "Regions",
       y = "Cropped area",
       title = "Average area by crop",
       subtitle = "",
       caption = "Q)  Which of the following crops do you grow - percentage by area? 
       NB percentage area of crop type is converted to cropped land using Q2
       Average total area cropped over the last 3 seasons")
  

```


#### **Comments notes on Question 2 and 3** 

* We have converted the percentage of crop type to area based on Q2 average total area cropped over the last 3 seasons.
* All agronomist and growers grow mainly cereal crops and the smallest portion of there land is used for fallow.
* Canola and pulses are popular with both groups.
* If the cropped area is wrong for question 2, cropped area by crop will be wrong too! I have removed the agronomist data.

```{r aletrative for Q3, include=FALSE}
#Q3_percent <- data %>% 
function_Q3 <- function(clm, crop) {
  temp <- data %>%
  group_by(Resp_Group, !! clm) %>%
  summarise(count = n())
  
  colnames(temp)[3] <- crop
 return(temp)
}

Q_3.1 <- function_Q3(quo(Q_3.1), "wheat_count")
Q_3.2 <- function_Q3(quo(Q_3.2), "canola_count")
Q_3.3 <- function_Q3(quo(Q_3.3), "pulses_count")
Q_3.4 <- function_Q3(quo(Q_3.4), "pasture_count")
Q_3.5 <- function_Q3(quo(Q_3.5), "hay_count")
Q_3.6 <- function_Q3(quo(Q_3.6), "fallow_count")


```



#### **Question 4**

Agro) 

When thinking about your average client's annual variable costs, what percentage would fertilisers account for?

Grower) 

Of your total annual variable costs, what percentage would fertilisers account for?



```{r Q4 workings regions agro only, include=FALSE}
#head(data)
#table(data$Q_4)
##Looks like an error with data entry'greater than 35% and greater than 35% should be the same


data <- mutate(data,
             Q_4 =case_when(
               Q_4 == "'greater than 35%" ~  "greater than 35%",
               Q_4 == "greater than 35%" ~  "greater than 35%",
               TRUE ~ Q_4))
               
#table(data$Q_4)
#check out if we have any missing data for this question
# data %>% group_by(Resp_Group) %>%
#         summarise(sum(is.na(Q_4)))


Q4_resp_percent <- data %>% 
  group_by(Resp_Group) %>% 
  count(Q_4) %>% 
  mutate(percent = round(
           (freq = n / sum(n)),2))
Q4_resp_percent


Q4_resp_percent$Q_4 <- factor(Q4_resp_percent$Q_4, 
                              levels = c("0-5%","5-10%", "10-15%","15-20%",
                                         "20-25%","25-30%", "30-35%", "greater than 35%", "Unsure" ))

```

```{r Q4 table regions agro only, echo=FALSE}

filter(Q4_resp_percent, Resp_Group == 	"Agronomist") %>%
  datatable(
    options = list(pageLength = 35, dom = 't'),
    colnames = c(
      'Respondent' = 'Resp_Group',
      'Total annual variable costs' = 'Q_4',
      'Number of respondents' = 'n'
    )
  ) %>%
  formatPercentage('percent', 0) 



filter(Q4_resp_percent, Resp_Group == 	"Grower") %>%
  datatable(
    options = list(pageLength = 35, dom = 't'),
    colnames = c(
      'Respondent' = 'Resp_Group',
      'Total annual variable costs' = 'Q_4',
      'Number of respondents' = 'n'
    )
  ) %>%
  formatPercentage('percent', 0) 
```

```{r Q4 graph regions agro only, echo=FALSE}
ggplot(Q4_resp_percent, aes(Q_4, percent, fill =Resp_Group ))+
  geom_col()+
  scale_fill_manual(values=c("grey70", "grey40"))+
  facet_wrap(~Resp_Group)+
  theme_classic()+
  labs(x= "",
       y = "",
       title = "Percent of annual variable costs attributed to fertilisers",
       #subtitle = "Agronomist and grower",
       caption = "Q)  Of your total annual variable costs, what percentage would fertilisers account for?")+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(size = 8), legend.position = "none") +
        scale_y_continuous("All respondent", breaks=seq(0, 1.0, 0.1)
                           , labels=c("0%", "10%", "20%", "30%", "40%", "50%", "60%", "70%", "80%", "90%", "100%"), limits = c(0,0.5))
  

```

**Question 4 with extra grouping of bins**

```{r Q4 working more grouping1, echo=FALSE}

data <- mutate(data,
               Q_4_group =case_when(
                 Q_4 == "0-5%" ~  "<20%",
                 Q_4 == "5-10%" ~  "<20%",
                 Q_4 == "10-15%" ~  "<20%",
                 Q_4 == "15-20%" ~  "<20%",
                 Q_4 == "20-25%" ~  "20-35%",
                 Q_4 == "25-30%" ~  "20-35%",
                 Q_4 == "30-35%" ~  "20-35%",
                 Q_4 == "greater than 35%" ~  ">35%",
                 Q_4 == "Unsure" ~  "Unsure"))


#with(data,table(Q_4_group,Resp_Group))


Q4group_resp_percent <- data %>% 
  group_by(Resp_Group) %>% 
  count(Q_4_group) %>% 
  mutate(percent = round(
    (freq = n / sum(n)),2))
#Q4group_resp_percent


Q4group_resp_percent$Q_4_group <- factor(Q4group_resp_percent$Q_4_group, 
                              levels = c("<20%","20-35%", ">35%", "Unsure" ))

```

```{r Q4 working more grouping2, echo=FALSE}
ggplot(Q4group_resp_percent, aes(Q_4_group, percent, fill = Resp_Group ))+
  geom_col()+
  scale_fill_manual(values=c("grey70", "grey40"))+
  facet_wrap(~Resp_Group)+
  theme_classic()+
  labs(x= "percentage of total variable cost - more grouping",
       y = "percent response",
       title = "Percent of annual variable costs attributed to fertilisers",
       #subtitle = "Agronomist and grower",
       caption = "Q)  Of your total annual variable costs, what percentage would fertilisers account for?")+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(size = 8), legend.position = "none") +
  scale_y_continuous("All respondent", breaks=seq(0, 1.0, 0.1)
                     , labels=c("0%", "10%", "20%", "30%", "40%", "50%", "60%", "70%", "80%", "90%", "100%"), limits = c(0,0.5))

```







**Question 4 with bins grouped and by regions merged**








```{r Q4 regions working1, echo=FALSE, warning=FALSE}



Q4group_resp__regions_merged_percent <- data %>% 
  group_by(Resp_Group, region_merge) %>% 
  count(Q_4_group) %>% 
  mutate(percent = round(
    (freq = n / sum(n)),2))


Q4group_resp__regions_merged_percent$Q_4_group <- factor(Q4group_resp__regions_merged_percent$Q_4_group, 
                              levels = c("<20%","20-35%", ">35%", "Unsure" ))

# filter(Q4group_resp__regions_merged_percent, Resp_Group == "Agronomist") %>% 
# datatable(Q4group_resp__regions_merged_percent)
```



```{r Q4 regions graph, echo=FALSE, warning=FALSE}
filter(Q4group_resp__regions_merged_percent, Resp_Group == "Agronomist") %>% 
ggplot( aes(Q_4_group, percent))+
  geom_col(fill = "grey70", color = "black")+
  facet_wrap(. ~ region_merge)+
  theme_classic()+
  labs(x= "percentage of total variable cost",
       y = "percent response",
       title = "Percent of annual variable costs attributed to fertilisers - more grouping",
       subtitle = "Agronomist",
       caption = "Q)  Of your total annual variable costs, what percentage would fertilisers account for?")+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(size = 8)) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L), limits = c(0,0.75))


filter(Q4group_resp__regions_merged_percent, Resp_Group == "Grower") %>% 
ggplot( aes(Q_4_group, percent))+
  geom_col(fill = "grey40", color = "black")+
  facet_wrap(. ~ region_merge)+
  theme_classic()+
  labs(x= "percentage of total variable cost",
       y = "percent response",
       title = "Percent of annual variable costs attributed to fertilisers - more grouping",
       subtitle = "Grower",
       caption = "Q)  Of your total annual variable costs, what percentage would fertilisers account for?")+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(size = 8)) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L), limits = c(0,0.75))

```





Note that percentages is calculated for each regional grouping (by agronomist or grower)



**Question 4 with bins grouped and by rainfall**

```{r Q4 regions working, echo=FALSE}



Q4group_resp__rainfall_percent <- data %>% 
  group_by(Resp_Group, rainfall) %>% 
  count(Q_4_group) %>% 
  mutate(percent = round(
    (freq = n / sum(n)),2))


Q4group_resp__rainfall_percent$Q_4_group <- factor(Q4group_resp__rainfall_percent$Q_4_group, 
                              levels = c("<20%","20-35%", ">35%", "Unsure" ))


# filter(Q4group_resp__rainfall_percent, Resp_Group == "Agronomist") %>%
# datatable(Q4group_resp__rainfall_percent)
# filter(Q4group_resp__rainfall_percent, Resp_Group == "Grower") %>%
# datatable(Q4group_resp__rainfall_percent)

```



```{r Q4 regions table and graph, echo=FALSE}

### Table agro
filter(Q4group_resp__rainfall_percent, Resp_Group == 	"Agronomist" ) %>% 
  datatable(options = list(pageLength = 35, dom = 't'),
    colnames = c('Respondent' = 'Resp_Group', 
                         'Total annual variable costs' = 'Q_4_group', 
                         'Number of respondents' = 'n')) %>% 
  formatPercentage('percent', 0)

### graph agro
filter(Q4group_resp__rainfall_percent, Resp_Group == "Agronomist") %>% 
ggplot( aes(Q_4_group, percent))+
  geom_col(fill = "grey70", color = "black")+
  facet_wrap(. ~ rainfall)+
  theme_classic()+
  labs(x= "percentage of total variable cost",
       y = "percent response for rainfall grouping",
       title = "Percent of annual variable costs attributed to fertilisers - more grouping",
       subtitle = "Agronomist",
       caption = "Q)  Of your total annual variable costs, what percentage would fertilisers account for?")+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(size = 8)) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L), limits = c(0,1))


### table grower
filter(Q4group_resp__rainfall_percent, Resp_Group == 	"Grower" ) %>% 
  datatable(options = list(pageLength = 35, dom = 't'),
    colnames = c('Respondent' = 'Resp_Group', 
                         'Total annual variable costs' = 'Q_4_group', 
                         'Number of respondents' = 'n')) %>% 
  formatPercentage('percent', 0)
### graph grower
filter(Q4group_resp__rainfall_percent, Resp_Group == "Grower") %>% 
ggplot( aes(Q_4_group, percent))+
  geom_col(fill = "grey40", color = "black")+
  facet_wrap(. ~ rainfall)+
  theme_classic()+
  labs(x= "percentage of total variable cost",
       y = "percent response for rainfall grouping",
       title = "Percent of annual variable costs attributed to fertilisers - more grouping",
       subtitle = "Grower",
       caption = "Q)  Of your total annual variable costs, what percentage would fertilisers account for?")+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(size = 8)) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L))



```

Note that percentages is calculated for each rainfall grouping (by agronomist or grower)



#### **Comments notes on Question 4** 


* Question and answer results in a percent of percent, which is very confusing.
* I have done additional grouping of the bins
* Note that in the original survey there is a problem with the coding of >35%, it is fixed here. This means that prelim report is wrong, the report says 5% but is more like 9% of growers estimate the fertiliser expenditure was more than 30%.
* Agronomist estimate that over 20% of there clients spend more than 35% of there variable cost on fertiliser, while less than 10% of growers spend this amount.
* Generally growers spend less on fertilisers than what agronomist suggest. Almost 40% of growers spend less than 20% of there variable costs on fertilisers.
* when the bins are grouped into 4 classes only, close to 50% of both growers and agronomist suggest that they spend between 20-35% of there variable costs on fertilisers.
* I have reported fertiliser cost per region and rainfall, but the sample size is very low for some of these classes.





#### **Question 5**

Agro) 

What are the main nutrient deficiencies your clients encounter?

Grower)

What are the main nutrient deficiencies on your farm?

```{r Q5 new nutrient def clms, include=FALSE}
data <- mutate(data, 
               Q_5.2_N = case_when(str_detect(Q_5.2,   fixed("N",  ignore_case = TRUE)) ~ "N", TRUE ~ "NA"),
               Q_5.2_P = case_when(str_detect(Q_5.2,   fixed("P",  ignore_case = TRUE)) ~ "P", TRUE ~ "NA"),
               Q_5.2_S = case_when(str_detect(Q_5.2,   fixed("S",  ignore_case = TRUE)) ~ "S", TRUE ~ "NA"),
               Q_5.2_Zn = case_when(str_detect(Q_5.2,  fixed("Zn",  ignore_case = TRUE)) ~ "Zn", TRUE ~ "NA"),
               Q_5.2_Cu = case_when(str_detect(Q_5.2,  fixed("Cu",  ignore_case = TRUE)) ~ "Cu", TRUE ~ "NA"),
               Q_5.2_Mn = case_when(str_detect(Q_5.2,  fixed("Mn",  ignore_case = TRUE)) ~ "Mn", TRUE ~ "NA"),
               Q_5.2_pH = case_when(str_detect(Q_5.2,  fixed("pH",  ignore_case = TRUE)) ~ "pH", TRUE ~ "NA"),
               Q_5.2_Fe = case_when(str_detect(Q_5.2,  fixed("Fe",  ignore_case = TRUE)) ~ "Fe", TRUE ~ "NA"),
               Q_5.2_Mg = case_when(str_detect(Q_5.2,  fixed("Mg",  ignore_case = TRUE)) ~ "Mg", TRUE ~ "NA")
)


Q_5.2_N <- data %>% 
  group_by(Resp_Group) %>% 
  count(Q_5.2_N) %>% 
  mutate(percent = 
           (freq = n / sum(n))) %>% 
  filter(Q_5.2_N != "NA") %>% 
  select(Resp_Group, percent) %>% 
  mutate( nutrient = "N")

Q_5.2_P <- data %>% 
  group_by(Resp_Group) %>% 
  count(Q_5.2_P) %>% 
  mutate(percent = round(
    (freq = n / sum(n)),2)) %>% 
  filter(Q_5.2_P != "NA") %>% 
  select(Resp_Group, percent) %>% 
  mutate( nutrient = "P")

Q_5.2_S <- data %>% 
  group_by(Resp_Group) %>% 
  count(Q_5.2_S) %>% 
  mutate(percent = round(
    (freq = n / sum(n)),2)) %>% 
  filter(Q_5.2_S != "NA") %>% 
  select(Resp_Group, percent) %>% 
  mutate( nutrient = "S")

Q_5.2_Zn <- data %>% 
  group_by(Resp_Group) %>% 
  count(Q_5.2_Zn) %>% 
  mutate(percent = round(
    (freq = n / sum(n)),2)) %>% 
  filter(Q_5.2_Zn != "NA") %>% 
  select(Resp_Group, percent) %>% 
  mutate( nutrient = "Zn")

Q_5.2_Cu <- data %>% 
  group_by(Resp_Group) %>% 
  count(Q_5.2_Cu) %>% 
  mutate(percent = round(
    (freq = n / sum(n)),2)) %>% 
  filter(Q_5.2_Cu != "NA") %>% 
  select(Resp_Group, percent) %>% 
  mutate( nutrient = "Cu")

Q_5.2_Mn <- data %>% 
  group_by(Resp_Group) %>% 
  count(Q_5.2_Mn) %>% 
  mutate(percent = round(
    (freq = n / sum(n)),2)) %>% 
  filter(Q_5.2_Mn != "NA") %>% 
  select(Resp_Group, percent) %>% 
  mutate( nutrient = "Mn")

Q_5.2_pH <- data %>% 
  group_by(Resp_Group) %>% 
  count(Q_5.2_pH) %>% 
  mutate(percent = round(
    (freq = n / sum(n)),2)) %>% 
  filter(Q_5.2_pH != "NA") %>% 
  select(Resp_Group, percent) %>% 
  mutate( nutrient = "pH")

Q_5.2_Fe <- data %>% 
  group_by(Resp_Group) %>% 
  count(Q_5.2_Fe) %>% 
  mutate(percent = round(
    (freq = n / sum(n)),2)) %>% 
  filter(Q_5.2_Fe != "NA") %>% 
  select(Resp_Group, percent) %>% 
  mutate( nutrient = "Fe")

Q_5.2_Mg <- data %>% 
  group_by(Resp_Group) %>% 
  count(Q_5.2_Mg) %>% 
  mutate(percent = round(
    (freq = n / sum(n)),2)) %>% 
  filter(Q_5.2_Mg != "NA") %>% 
  select(Resp_Group, percent) %>% 
  mutate( nutrient = "Mg")

### These are the same size and can be mereged as is...
nutr_def <- rbind(Q_5.2_N, Q_5.2_P, Q_5.2_S,  Q_5.2_Zn,
              Q_5.2_Cu, Q_5.2_Mn, Q_5.2_pH, Q_5.2_Fe, Q_5.2_Mg ) 

add_lines <- tibble (Resp_Group = c("Grower", "Grower"),
                         percent = c(0, 0),
                         nutrient = c("Fe", "Mg"))

nutr_def_all <- full_join(nutr_def, add_lines)


nutr_def_all <- mutate(nutr_def_all, nutrient = fct_relevel(nutrient, c("N", "P", 
                                                                "S", 
                                                                "Zn", 
                                                                "Cu", 
                                                                "Mn",
                                                                "pH",
                                                                "Fe",
                                                                "Mg")))


```


```{r Q5 new nutrient def clms graph, echo=FALSE}
## tables
select(nutr_def_all, Resp_Group, nutrient, percent) %>% 
filter(Resp_Group == "Agronomist" ) %>% 
  datatable(options = list(pageLength = 35, dom = 't'),
    colnames = c('Respondent' = 'Resp_Group', 
                         'Nutrient Deficiency' = 'nutrient' )) %>% 
  formatPercentage('percent', 0)


select(nutr_def_all, Resp_Group, nutrient, percent) %>% 
filter(Resp_Group == "Grower" ) %>% 
  datatable(options = list(pageLength = 35, dom = 't'),
    colnames = c('Respondent' = 'Resp_Group', 
                         'Nutrient Deficiency' = 'nutrient' )) %>% 
  formatPercentage('percent', 0)



## graphs

ggplot( nutr_def_all, aes(nutrient, percent, fill = Resp_Group ))+
  geom_col()+
  scale_fill_manual(values=c("grey70", "grey40"))+
  facet_wrap(. ~ Resp_Group)+
  theme_classic()+
  labs(x= "",
       y = "Percent of all agronomist / grower",
       title = "Percent of clients / growers with type of nutrient deficiencies",
       subtitle = "",
       caption = "Q)  What are the main nutrient deficiencies")+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(size = 8), legend.position = "none") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L))


```

This might be a bit confusing, here we have counted the number of individual stating they have a certain deficiency and then expressed this as a percentage of all the growers / or agronomist in the survey, displaying the results above.
For example, for nitrogen deficiencies; of the 71 agronomist in the survey, 60 said they have a client with n deficiency - so this is 85%

Belinda Cay has reported similar values although her % are slightly different she is only using 70 agronomist rather than 71, not sure why?




#### **Question 6** 


Agro) 

Do you recommend soil and or plant testing?

Grower)

Do you do soil and/or plant testing on your farm?





```{r Q6 agro summary agro and grower, echo=FALSE}

#check out if we have any missing data for this question
 # data %>% group_by(Resp_Group) %>%
 #          summarise(sum(is.na(Q_6)))


Q6_all_agro <- filter(data, Resp_Group == "Agronomist") %>% 
  count(Q_6) %>% 
  mutate(percent = 
        (freq = n / sum(n)))

Q6_all_agro <- group_by(data, Resp_Group) %>% 
  count(Q_6) %>% 
  mutate(percent = 
        (freq = n / sum(n)))

#head(Q6_all_agro)
```

```{r Q6 agro summary agro and grower graph, echo=FALSE}

ggplot(Q6_all_agro, aes(Q_6, percent, fill = Resp_Group))+
  geom_col()+
  #geom_text(aes(label = percent(signif(percent),1), vjust = -1.0, hjust = 0.5))+
  scale_fill_manual(values=c("grey70", "grey40"))+
  theme_classic()+
  facet_wrap(~ Resp_Group)+
  labs(x= "All regions",
       y = "percentage of respondents",
       title = "Recommend soil and or plant testing",
       subtitle = "",
       caption = "Q) Do you recommend soil and or plant testing?")+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(size = 8), legend.position = "none") + 
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L), limits=c(0, 1.1))
```


```{r Q6 regions merged summary, include=FALSE}
#agronomist by region

#check out if we have any missing data for this question
  #data %>% group_by(Resp_Group) %>%
  #         summarise(sum(is.na(Q_6)))

Q6_by_Region_merge <- 
  group_by(data, region_merge, Resp_Group) %>%
  count(Q_6) %>% 
  mutate(percent = 
           (freq = n / sum(n)))

#head(Q6_by_Region_merge)
```

```{r Q6 regions merged summary graph , echo=FALSE}
ggplot(Q6_by_Region_merge, aes(region_merge, percent, fill=Q_6 ))+
  geom_col()+
  facet_wrap(. ~ Resp_Group)+
  #geom_text(aes(label = percent(signif(percent),1), vjust = -1.0, hjust = 0.5))+
  theme_classic()+
  labs(x= "Regions",
       y = "percentage of respondents",
       fill = "",
       title = "Recommend soil and or plant testing",
       subtitle = "",
       caption = "Q) Do you recommend soil and or plant testing?")+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(size = 8)) + 
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L), limits=c(0, 1.1))

```




```{r Q6 agro summary agronomist saying no, echo=FALSE}

filter(Q6_by_Region_merge, Q_6 == "No") %>% 
ggplot(aes(region_merge, percent, fill = Resp_Group))+
  geom_col()+
  scale_fill_manual(values=c("grey70", "grey40"))+
  facet_wrap(~ Resp_Group)+
  #geom_text(aes(label = percent(signif(percent),1), vjust = -1.0, hjust = 0.5))+
  theme_classic()+
  labs(x= "",
       y = "percentage of respondents not testing",
       title = "Not recommending soil and or plant testing",
       subtitle = "",
       caption = "Q) Do you recommend soil and or plant testing?")+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(size = 8), legend.position = "none" )+
       scale_y_continuous(labels = scales::percent_format(accuracy = 5L), limits=c(0, 0.6))
        #scale_y_continuous("Percentage not testing", limits=c(0, 0.7),breaks=seq(0, 1.0, 0.1)
        #                   , labels=c("0%", "10%", "20%", "30%", "40%", "50%", "60%", "70%", "80%", "90%", "100%"))


```



# **Decision making**


#### **Question 7**

Grower)

Who makes the nutrient decisions on your farm?

* Self
* Agronomist
* Combination of agronomist and self
* Other
* Other (please specify)





```{r Q7 who makes decision, echo=FALSE}

Q7 <- filter (data, Resp_Group == "Grower" &  Q_7 !=  "NA")%>%
  group_by( Resp_Group) %>%
  count(Q_7) %>% 
  mutate(percent = 
           (freq = n / sum(n)))

Q7 <- mutate(Q7,
             Q_7 =case_when(
               Q_7 == "Combination of agronomist and self" ~  "Combination",
               TRUE ~ Q_7
             ))


Q7 <- mutate(Q7, Q_7 = fct_relevel(
  Q_7,
  c(
    "Agronomist",
    "Self",
    "Combination" ,
    "Other"
  )
))

### table

  datatable(Q7,options = list(pageLength = 35, dom = 't'),
            colnames = c('Respondent' = 'Resp_Group', 
                         'Who makes the decision' = 'Q_7',
                         "Counts" = "n",
                         "Percent" = "percent")) %>% 
  formatPercentage('Percent', 0)

ggplot(Q7, aes(Q_7 , percent ))+
  geom_col(fill = "grey40", color = "black")+
  #facet_wrap(. ~ Resp_Group)+
  #geom_text(aes(label = percent(signif(percent),1), vjust = -1.0, hjust = 0.5))+
  theme_classic()+
  labs(x= "",
       y = "percentage of growers who responded",
       fill = "",
       title = "Decisions on your farm?",
       subtitle = "",
       caption = "Q) Who makes the nutrient decisions on your farm?")+
  theme(axis.text.x=element_text(angle=45,hjust=1),
        plot.caption = element_text(size = 8), legend.position = "none") + 
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L), limits=c(0, 0.8))
```




#### **Comments notes on Question 7** 


* 57 of the 99 growers responded to this question.






#### **Question 8**

Agronomist)


* Q8.1 Of your clients, how many of them rely **entirely** on you to make the nutrient decisions?

* Q8.2 Of your clients, how many of them rely **somewhat** on you to make the nutrient decisions?

* Q8.3 Of your clients, how many of them make their **own** nutrient decisions?



```{r Q8.1_8.2 working who makes decision, include=FALSE}
### Q8

Q8_1 <- filter (data, Resp_Group == "Agronomist" &  Q_8.1 !=  "NA")%>%
  group_by( Resp_Group) %>%
  count(Q_8.1) %>% 
  mutate(percent = 
           (freq = n / sum(n)),
         who_makes_desision = "entirely",
         "bin" = Q_8.1) %>% 
  select(-Q_8.1)

Q8_1
Q8_2 <- filter (data, Resp_Group == "Agronomist" &  Q_8.2 !=  "NA")%>%
  group_by( Resp_Group) %>%
  count(Q_8.2) %>% 
  mutate(percent = 
           (freq = n / sum(n)),
         who_makes_desision = "somewhat " ,
         "bin" = Q_8.2)%>% 
  select(-Q_8.2)
Q8_2
Q8_3 <- filter (data, Resp_Group == "Agronomist" &  Q_8.3 !=  "NA")%>%
  group_by( Resp_Group) %>%
  count(Q_8.3) %>% 
  mutate(percent = 
           (freq = n / sum(n)),
         who_makes_desision = "own" ,
         "bin" = Q_8.3)%>% 
  select(-Q_8.3)
         
Q8_1$percent
Q8_2$percent
Q8_3$percent

Q8_1_3 <- rbind(Q8_1, Q8_2, Q8_3)
Q8_1_3$percent
str(Q8_1_3)
Q8_1_3_table <- Q8_1_3



# Create a extra line - wow that was hard!
append <- data.frame("Agronomist", "0.0", "1.2", "own", "90-100%" )
names(append)<-c(" Resp_Group", "n", "percent", "who_makes_desision", "bin")
str(append)
append$percent <- as.numeric(as.character(append$percent))
append$n <- as.numeric(as.character(append$n))
str(append)

Q8_1_3 <- data.frame(rbind(as.matrix(Q8_1_3), as.matrix(append)))
str(Q8_1_3)
Q8_1_3$percent <- as.numeric(as.character(Q8_1_3$percent))
Q8_1_3$n <- as.numeric(as.character(Q8_1_3$n))

#unique(Q8_1_3$who_makes_desision)

Q8_1_3 <- mutate(Q8_1_3, bin = fct_relevel(bin, c("less than 10%", "10-30%", "30-50%",  "50-70%",
                                                  "70-90%", "90-100%"
)))




```

```{r Q8.1_8.2 tabel graph who makes decision, echo=FALSE, warning=FALSE}


### table

select(Q8_1_3_table, Resp_Group, who_makes_desision, bin, n, percent  ) %>% 
  datatable(options = list(pageLength = 35, dom = 't'),
            colnames = c('Respondent' = 'Resp_Group', 
                         'Who makes the decision' = 'who_makes_desision',
                         "Ans" = "bin",
                         "Percent" = "percent")) %>% 
  formatPercentage('Percent', 0)



### graph

ggplot(Q8_1_3, aes(bin , percent))+
  geom_col(fill = "grey70", color = "black")+
  facet_wrap(.~ who_makes_desision)+
  #geom_text(aes(label = percent(signif(percent),1), vjust = -1.0, hjust = 0.5))+
  #geom_text(aes(label = n, vjust = -1.0, hjust = 0.5))+
  theme_classic()+
  labs(x= "",
       y = "percentage",
       fill = "",
       title = "Rely somewhat on agronomist to make nutrient decisions?",
       subtitle = "Agronomist only",
       caption = "Q) Of your clients, how many of them rely somewhat on you to make the nutrient decisions?")+
  theme(axis.text.x=element_text(angle=45,hjust=1),
        plot.caption = element_text(size = 8), legend.position = "none") + 
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L), limits=c(0, 0.8))


```

* 64 agronomist answered this out of possible 71
* The percentage is expressed by using a total of 64 agronomist (rather than 71).



#### **Question 9**

Agronomist)

To what extent are you responsible for determining how much testing is done on your clients' farms? - Q9.1

Grower)

To what extent does your agronomist determine how much testing is done on your farm? (i.e. % of decision made by your agronomist) - Q 9.1 



```{r Q9.1 how much testing working, message=FALSE, warning=TRUE, include=FALSE}

data %>% group_by(Resp_Group) %>% summarise(non_na_count = sum(!is.na(Q_9.1)))
# agro had 63 respondants out of 71
# grower had 56 respondants out of 99


data <- mutate(data,
               Q_9.1 =case_when(
                 Q_9.1 == "90-100%" ~  ">90%",
                 Q_9.1 == "100%" ~  ">90%",
                 TRUE ~ Q_9.1
                 ))

#data$Q_9.1

Q9_1 <- filter (data,   Q_9.1 !=  "NA")%>%
  group_by( Resp_Group) %>%
  count(Q_9.1) %>% 
  mutate(percent = 
           (freq = n / sum(n)))

#Q9_1

add_lines9 <- tibble (Resp_Group = c("Grower", "Agronomist"),
                      percent = c(0, 0),
                      Q_9.1 = c( "less than 10%", "None"))
#add_lines9
Q9_1 <- full_join(Q9_1, add_lines9)

#Q9_1
Q9_1 <- mutate(Q9_1, Q_9.1 = fct_relevel(Q_9.1, c("less than 10%", "10-30%", "30-50%", "50-70%",
                                                  "70-90%", ">90%", "None")))

```

```{r Q9.1 graph how much testing, echo=FALSE, message=FALSE, warning=TRUE}
ggplot(Q9_1, aes(Q_9.1 , percent, fill =  Resp_Group))+
  geom_col()+
  facet_wrap(. ~ Resp_Group)+
  scale_fill_manual(values=c("grey70", "grey40"))+
  #geom_text(aes(label = percent(signif(percent),1), vjust = -1.0, hjust = 0.5))+
  theme_classic()+
  labs(x= "",
       y = "",
       fill = "",
       title = "To what extent determined testing?",
       subtitle = "",
       caption = "Q) To what extent are you responsible for determining how much testing is done on your clients' farms?
                     To what extent does your agronomist determine how much testing is done on your farm? ")+
  theme(axis.text.x=element_text(angle=45,hjust=1),
        plot.caption = element_text(size = 8), legend.position = "none") + 
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L), limits=c(0, 0.5))

```


```{r Q9.2 how much testing, echo=FALSE, message=FALSE, warning=TRUE}


filter(data, Q_9.2 !=  "NA") %>% 
  select( Resp_Group, Q_9.2) %>% 
datatable(options = list(pageLength = 35, dom = 't'),
   colnames = c( "Other reasons" = "Q_9.2", 'Respondent' = 'Resp_Group'))   
        
      

```





#### **Comments notes on Question 9.1 and 9.2**

* Combined results for 90-100 and 100% to read >90%. 
* 63 agronomist responded to question, out of a possible 71
* 56 grower responded to question, out of a possible 99.
* Note that 'none' was included as a response to the question, so therefore it was included in the analysis (when calculating the percentage)
* All agronomist who answered this question (63/71) recommended testing - 'None' = 0
* While 6 growers answered none to recommending testing (note that 56 growers out of a possible 99 answered this question)
* Just to be clear there are a group of survey participants that did not answer this question and there were a group that answered none to this question.


Q9.2 other comments listed (above)



#### **Question 10** 


Agronomist)

To what extent do the test results influence your recommendations?  (Q_10.1)

Grower)

To what extent does your agronomist make recommendations based on the test results from your farm?  (Q_10.1)


Agronomist other
This is text answer nominated by 6 agronomists  (Q_10.2)



```{r Q10.1 how much testing, message=FALSE, warning=TRUE, include=FALSE}
#suss out how many ans questions


data %>% group_by(Resp_Group) %>% summarise(non_na_count_10.1 = sum(!is.na(Q_10.1)))



data <- mutate(data,
               Q_10.1 =case_when(
                 Q_10.1 == "90-100%" ~  ">90%",
                 Q_10.1 == "100%" ~  ">90%",
                 TRUE ~ Q_10.1
                 ))

Q10_1 <- filter (data,   Q_10.1 !=  "NA")%>%
  group_by( Resp_Group) %>%
  count(Q_10.1) %>% 
  mutate(percent = 
           (freq = n / sum(n)))
#Q10_1
add_lines10 <- tibble (Resp_Group = c("Agronomist"),
                    percent = c(0),
Q_10.1 = c( "None" ))
Q10_1 <- full_join(Q10_1, add_lines10)

Q10_1 <- mutate(Q10_1, Q_10.1 = fct_relevel(Q_10.1, c("10-30%", "30-50%", "50-70%",
                                                  "70-90%", ">90%" ,"None")))

```

```{r Q10.1 table and graph - how much testing, echo=FALSE, message=FALSE, warning=TRUE}



datatable(Q10_1, options = list(pageLength = 35, dom = 't'),
            colnames = c( "bins" = "Q_10.1", "Respondent" = "Resp_Group")) %>% 
    formatPercentage('percent', 0)  



ggplot(Q10_1, aes(Q_10.1 , percent, fill = Resp_Group))+
  geom_col()+
  scale_fill_manual(values=c("grey70", "grey40"))+
  facet_wrap(. ~ Resp_Group)+
  theme_classic()+
  labs(x= "extent of influence",
       y = "Percent of respondents",
       fill = "",
       title = "To what extent do test results have a influence on recommendations?",
       subtitle = "",
       caption = "Q)  To what extent do the test results influence your recommendations? 
       To what extent does your agronomist make recommendations based on the test results from your farm? ")+
  
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(hjust = 0), legend.position = "none") +
 
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L), limits=c(0, 0.5))


```



```{r Q10.1 how much testing more bins working, message=FALSE, warning=TRUE, include=FALSE}
data <- mutate(data,
                 Q_10_1group =case_when(
                   Q_10.1 == "None" ~  "not much of the time",
                   Q_10.1 == "10-30%" ~  "not much of the time",
                   Q_10.1 == "30-50%" ~  "not much of the time",
                   Q_10.1 == "50-70%" ~  "most of the time",
                   Q_10.1 == "70-90%" ~  "most of the time",
                   Q_10.1 == ">90%" ~  "most of the time"
                   # Q_10.1 == "100%" ~  "most of the time"
                 ))
  
  Q10_1_group_df <- filter (data,   Q_10_1group !=  "NA")%>%
    group_by( Resp_Group) %>%
    count(Q_10_1group) %>% 
    mutate(percent = 
             (freq = n / sum(n)))
  
  Q10_1_group_df

```




```{r Q10.1 how much testing more bins graph and table , echo=FALSE, message=FALSE, warning=TRUE}

#table
  
  datatable(Q10_1_group_df, options = list(pageLength = 35, dom = 't'),
            colnames = c( "grouping of bins" = "Q_10_1group", 
                          "Respondent" = "Resp_Group")) %>% 
    formatPercentage('percent', 0)  
  


ggplot(Q10_1_group_df, aes(Q_10_1group , percent, fill = Resp_Group ))+
  geom_col()+
  scale_fill_manual(values=c("grey70", "grey40"))+
  facet_wrap(. ~ Resp_Group)+
  #geom_text(aes(label = percent(signif(percent),1), vjust = -1.0, hjust = 0.5))+
  theme_classic()+
  labs(x= "",
       y = "Percent of respondents",
       fill = "",
       title = "To what extent do test results have a influence on recommendations?",
       subtitle = "",
       caption = "Q) To what extent do the test results influence your recommendations?
                     To what extent does your agronomist make recommendations based on the test results from your farm? ")+
  
  theme(axis.text.x=element_text(angle=45,hjust=1),
        plot.caption = element_text(hjust = 1), legend.position = "none") +
  
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L), limits=c(0, 0.8))
```

```{r Q10.2 how much testing, echo=FALSE, message=FALSE, warning=TRUE}



#table
  otherQ10.2 <- filter(data, Q_10.2 !=  "NA") %>% select(Resp_Group, Q_10.2 )
  
  datatable(otherQ10.2, options = list(pageLength = 35, dom = 't'),
            colnames = c( "Comments" = "Q_10.2", 
                          "Respondent" = "Resp_Group")) 

```






#### **Comments notes on Question 10** 

* This question can be a bit confusing.
* The question was asked as a percentage - this make the graph / analysis a percentage of a percentage, which is hard to interpret
* Each respondent was asked: 
* to what extent do test results influence recommendations, the respondents were asked to nominate a certain percentage category e.g. between 10-30% of test results influence the recommendation this is what is displayed on the x axis.

* Not all participants in the survey answered this question, 63 agronomist answered and 56 growers.
* The percentage on the graph indicate the percentage of agronomist or growers who answered the question.
* Belinda Cay grower values are a bit different to mine - could the a problem with the last grouping for the question. I have coded 90-100 and 100% as > 90% while I don't think Belinda has done this.

* I have done some grouping of the bins, so we have two bins; most of the time example most of the time > 50%  and not much of the time <50%






#### **Question 11**
Agronomist)

What are your 3 main sources of information or advice for what nutrients you recommend and at what rate? 

Indicate if this is different for N, P and other nutrients

* Source 1
* Source 2
* Source 3

Grower)

What are your 3 main sources of information or advice for what nutrients you apply and at what rate? 

Indicate if this is different for N, P and other nutrients

* Source 1
* Source 2
* Source 3

Note 
Q_11.1 is source 1 as answered (?)
Q_11.2 is source 1 coded dropping the indication if different


```{r Q11.2 source of advice, message=FALSE, warning=TRUE, include=FALSE}


data$Q_11.2

### use this this to count the how many we have in each class
subsetQ_11_coded_agro <- select(data, Q_11.2, Q_11.4, Q_11.6, Resp_Group) %>% 
  filter(Resp_Group == "Agronomist" )

sum(is.na(subsetQ_11_coded_agro$Q_11.2)) #number of NA in this Question 11
sum(is.na(subsetQ_11_coded_agro$Q_11.4)) #number of NA in this Question 14
sum(is.na(subsetQ_11_coded_agro$Q_11.6)) #number of NA in this Question 24

subsetQ_11_coded_grower <- select(data, Q_11.2, Q_11.4, Q_11.6, Resp_Group) %>% 
  filter(Resp_Group == "Grower" )


subsetQ_11_coded_agro
###By Agro

subsetQ_11.2_coded <- as.data.frame(count(subsetQ_11_coded_agro, vars = Q_11.2))
#subsetQ_11.2_coded
names(subsetQ_11.2_coded) <- c("source", "Q_11.2_count") 
#subsetQ_11.2_coded
subsetQ_11.4_coded <- as.data.frame(count(subsetQ_11_coded_agro, vars = Q_11.4))
names(subsetQ_11.4_coded) <- c("source", "Q_11.4_count") 
subsetQ_11.6_coded <- as.data.frame(count(subsetQ_11_coded_agro, vars = Q_11.6))
names(subsetQ_11.6_coded) <- c("source", "Q_11.6_count") 

#subsetQ_11.2_coded
#subsetQ_11.4_coded
#subsetQ_11.6_coded
#join all the count data togther

subsetQ_11_coded_agro_1 <- full_join(subsetQ_11.2_coded, subsetQ_11.4_coded )
#subsetQ_11_coded_agro_1
subsetQ_11_coded_agro <- full_join(subsetQ_11_coded_agro_1, subsetQ_11.6_coded )
#subsetQ_11_coded_agro

subsetQ_11_coded_agro$Q_11.2_count[is.na(subsetQ_11_coded_agro$Q_11.2_count)] <- 0
subsetQ_11_coded_agro$Q_11.4_count[is.na(subsetQ_11_coded_agro$Q_11.4_count)] <- 0
subsetQ_11_coded_agro$Q_11.6_count[is.na(subsetQ_11_coded_agro$Q_11.6_count)] <- 0
#subsetQ_11_coded_agro[is.na(subsetQ_11_coded_agro)] <- 0 # change NA to zero
#subsetQ_11_coded_agro

subsetQ_11_coded_agro <- filter(subsetQ_11_coded_agro, source != "NA")

subsetQ_11_coded_agro <- mutate(subsetQ_11_coded_agro, sum_count_sources = (Q_11.2_count + Q_11.4_count + Q_11.6_count)) #count the numbers in each source
#sum(subsetQ_11_coded_agro$sum_count_sources)
#subsetQ_11_coded_agro
subsetQ_11_coded_agro <- mutate(subsetQ_11_coded_agro, 
                                percent_source1 = (Q_11.2_count)/ sum(Q_11.2_count),
                                percent_all_sources = (sum_count_sources)/ sum(subsetQ_11_coded_agro$sum_count_sources))
#subsetQ_11_coded_agro
#sum(subsetQ_11_coded_agro$percent)

subsetQ_11_coded_agro <- mutate(subsetQ_11_coded_agro, 
                                source = fct_relevel(source, c("Test results", 
                                                               "Farm history/experience", 
                                                               "Industry data, research or agronomy tools",
                                                                "Yield maps/Data", 
                                                                "Yield modelling/estimates" ,
                                                                "Industry contacts",
                                                               "Local Trials",
                                                               "Other agronomists",
                                                               "Client expectations/targets",
                                                               "Seasonal economic environment",
                                                               "Local farming groups & events"
                                                               )))
```

```{r table and graph Q11.2 source of advice agro, echo=FALSE, message=FALSE, warning=TRUE}

select(subsetQ_11_coded_agro, source, Q_11.2_count, percent_source1, sum_count_sources, percent_all_sources) %>% 
datatable( options = list(pageLength = 35, dom = 't'),
           caption = "Agronomist",
            colnames = c( "source" = "source",
                          "source 1 count" = "Q_11.2_count",
                          "source 1 percent" = "percent_source1",
                          "three sources count " = "sum_count_sources",
                          "three sources percent" = "percent_all_sources")) %>%
  formatPercentage(c("source 1 percent", "three sources percent"), 0)
     
ggplot(subsetQ_11_coded_agro, aes( source , percent_source1 ))+
  geom_col(fill = "grey70", color = "black")+
  #facet_wrap(. ~ Resp_Group)+
  #geom_text(aes(label = percent(signif(percent),1), vjust = -1.0, hjust = 0.5))+
  theme_classic()+
  labs(x= "",
       y = "",
       fill = "",
       title = "Main sources of information or advice for what nutrients (source one only)",
       subtitle = "Agronomist only",
       caption = "Q) What are your 3 main sources of information or advice for what nutrients you recommend and at what rate? 
                     To what extent does your agronomist make recommendations based on the test results from your farm? ")+
  
  theme(axis.text.x=element_text(angle=45,hjust=1),
        plot.caption = element_text(hjust = 1)) +
  
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L), limits=c(0, 0.8))

ggplot(subsetQ_11_coded_agro, aes( source , percent_all_sources ))+
  geom_col(fill = "grey70", color = "black")+
  #facet_wrap(. ~ Resp_Group)+
  #geom_text(aes(label = percent(signif(percent),1), vjust = -1.0, hjust = 0.5))+
  theme_classic()+
  labs(x= "",
       y = "",
       fill = "",
       title = "Main three sources of information or advice for what nutrients",
       subtitle = "Agronomist only",
       caption = "What are your 3 main sources of information or advice for what nutrients you recommend and at what rate? 
                     To what extent does your agronomist make recommendations based on the test results from your farm?  ")+
  theme(axis.text.x=element_text(angle=45,hjust=1),
        plot.caption = element_text(hjust = 1)) +
  
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L), limits=c(0, 0.8))

```




```{r Q11.2 source of advice grower, message=FALSE, warning=TRUE, include=FALSE}


### use this this to count the how many we have in each class

subsetQ_11_coded_grower <- select(data, Q_11.2, Q_11.4, Q_11.6, Resp_Group) %>% 
  filter(Resp_Group == "Grower" )


sum(is.na(subsetQ_11_coded_grower$Q_11.2)) #number of NA in this Question 44
#sum(is.na(subsetQ_11_coded_grower$Q_11.4)) #number of NA in this Question 47
#sum(is.na(subsetQ_11_coded_grower$Q_11.6)) #number of NA in this Question 57

#subsetQ_11_coded_grower
###By Grower

subsetQ_11.2_codedg <- as.data.frame(count(subsetQ_11_coded_grower, vars = Q_11.2))
#subsetQ_11.2_codedg
names(subsetQ_11.2_codedg) <- c("source", "Q_11.2_count") 
#subsetQ_11.2_codedg
subsetQ_11.4_codedg <- as.data.frame(count(subsetQ_11_coded_grower, vars = Q_11.4))
names(subsetQ_11.4_codedg) <- c("source", "Q_11.4_count") 
subsetQ_11.6_codedg <- as.data.frame(count(subsetQ_11_coded_grower, vars = Q_11.6))
names(subsetQ_11.6_codedg) <- c("source", "Q_11.6_count") 

#subsetQ_11.2_codedg
#subsetQ_11.4_codedg
#subsetQ_11.6_codedg
#join all the count data togther

subsetQ_11_coded_grower_1 <- full_join(subsetQ_11.2_codedg, subsetQ_11.4_codedg )
#subsetQ_11_coded_grower_1
subsetQ_11_coded_grower <- full_join(subsetQ_11_coded_grower_1, subsetQ_11.6_codedg )
#subsetQ_11_coded_grower

subsetQ_11_coded_grower$Q_11.2_count[is.na(subsetQ_11_coded_grower$Q_11.2_count)] <- 0
subsetQ_11_coded_grower$Q_11.4_count[is.na(subsetQ_11_coded_grower$Q_11.4_count)] <- 0
subsetQ_11_coded_grower$Q_11.6_count[is.na(subsetQ_11_coded_grower$Q_11.6_count)] <- 0
#subsetQ_11_coded_agro[is.na(subsetQ_11_coded_agro)] <- 0 # change NA to zero
#subsetQ_11_coded_grower
subsetQ_11_coded_grower <- filter(subsetQ_11_coded_grower, source != "NA" & source != "c" 
                                       & source != "x" 
                                       & source != "y"
                                       & source != "z" 
                                       & source != "...")
#subsetQ_11_coded_grower                                     

subsetQ_11_coded_grower <- mutate(subsetQ_11_coded_grower, sum_count_sources = (Q_11.2_count + Q_11.4_count + Q_11.6_count)) #count the numbers in each source
#sum(subsetQ_11_coded_grower$sum_count_sources)
#subsetQ_11_coded_grower
subsetQ_11_coded_grower <- mutate(subsetQ_11_coded_grower, 
                                percent_source1 = (Q_11.2_count)/ sum(Q_11.2_count),
                                percent_all_sources = (sum_count_sources)/ sum(subsetQ_11_coded_grower$sum_count_sources))
#subsetQ_11_coded_grower
subsetQ_11_coded_grower <- arrange(subsetQ_11_coded_grower,desc (percent_source1))

#subsetQ_11_coded_grower

subsetQ_11_coded_grower <- mutate(subsetQ_11_coded_grower, 
                                source = fct_relevel(source, c( "Test results", 
                                                                "Agronomist",
                                                                "Farm history/experience",  
                                                                "Yield maps/Data",
                                                                "Industry data, research or agronomy tools", 
                                                                "Supplier info", 
                                                                "Yield modelling/estimates", 
                                                                "Local Trials",
                                                                "Local farming groups & events",
                                                                "Other farmers",  
                                                                "Seasonal economic environment" )))
```


```{r graph and table Q11.2 source of advice grower, echo=FALSE, message=FALSE, warning=TRUE}

select(subsetQ_11_coded_grower, source, Q_11.2_count, percent_source1, sum_count_sources, percent_all_sources) %>% 
datatable( options = list(pageLength = 35, dom = 't'),
           caption = "Grower",
            colnames = c( "source" = "source",
                          "source 1 count" = "Q_11.2_count",
                          "source 1 percent" = "percent_source1",
                          "three sources count " = "sum_count_sources",
                          "three sources percent" = "percent_all_sources")) %>%
  formatPercentage(c("source 1 percent", "three sources percent"), 0)

ggplot(subsetQ_11_coded_grower, aes( source , percent_source1 ))+
  geom_col(fill = "grey40", color = "black")+
  #facet_wrap(. ~ Resp_Group)+
  #geom_text(aes(label = percent(signif(percent),1), vjust = -1.0, hjust = 0.5))+
  theme_classic()+
  labs(x= "",
       y = "",
       fill = "",
       title = "Main sources of information or advice for what nutrients (source one only)",
       subtitle = "Growers only",
       caption = "Q) What are your 3 main sources of information or advice for what nutrients you apply and at what rate? 
       ")+
  
  theme(axis.text.x=element_text(angle=45,hjust=1),
        plot.caption = element_text(hjust = 1)) +
  
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L), limits=c(0, 0.5))


ggplot(subsetQ_11_coded_grower, aes( source , percent_all_sources ))+
  geom_col(fill = "grey40", color = "black")+
  #facet_wrap(. ~ Resp_Group)+
  #geom_text(aes(label = percent(signif(percent),1), vjust = -1.0, hjust = 0.5))+
  theme_classic()+
  labs(x= "",
       y = "",
       fill = "",
       title = "Main three sources of information or advice for what nutrients",
       subtitle = "Grower only",
       caption = "Q) What are your 3 main sources of information or advice for what nutrients you apply and at what rate? 
       ")+
  
  theme(axis.text.x=element_text(angle=45,hjust=1),
        plot.caption = element_text(hjust = 1)) +
  
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L), limits=c(0, 0.5))


```

#### **Comments notes on Question 11**

* Respondents were asked what the 3 main sources of information or advice for what nutrients and nutrient rate. 
* The results were graphed in two ways sources 1 only and also a combination source 1,2 & 3.
* The percentage of source 1 is expressed using the total number answering this question Agro (60)
* The percentage of source 1 is expressed using the total number answering this question Grower (53 - I had a few strange responses that could be coded)

* For Agro response rate was:
* source 1 = 11 NA , source 2 = 14 NA and source 3 = 24
* For growers response rate was:
* source 1 = 44 NA , source 2 = 47 NA and source 3 = 57 (not were had a few responses that could not be coded)

* Questioned asked to indicate if difference between N P and other nutrients, we have not considered this.


* The percentage of source 1, 2 and 3 is expressed using the total number answers for this question (not people) Agro is 162 and Grower is 142. * **Check if this is the best approach**





# **Soil testing** 
* This section explores how you use soil testing. If you have NOT done soil testing, please go to page  8.
* The above comment is from the survey script but some of the answers to the below question don't indicate this split.




#### **Question 12**

Grower)

Explain your approach to soil testing P, N and other micronutrients ...

* P
* N
* Micronutrients






```{r Q12.1 source of advice agro, message=FALSE, warning=TRUE, include=FALSE}

headers12_1 <- read_excel("Q12_ Assigning_Category ID_22.10.19.xlsx", 
                       sheet = "Q12.1", col_names=FALSE, range = "B4:E4")

head(headers12_1)

data_q12_1 <- read_excel("Q12_ Assigning_Category ID_22.10.19.xlsx", 
                       sheet = "Q12.1", col_names=FALSE, range = "B5:E174")
names(data_q12_1) <- headers12_1

head(data_q12_1)
data_q12_1 <- mutate(data_q12_1,
                   names_display =case_when(
                     Q_12.1_ID == "1" ~  "Shallow",
                     Q_12.1_ID  == "2" ~  "Cowell P",
                     Q_12.1_ID  == "3" ~  "Deep",
                     Q_12.1_ID  == "4" ~  "All depths",
                     Q_12.1_ID  == "5" ~  "Yield maps",
                     Q_12.1_ID  == "6" ~  "Programs",
                     Q_12.1_ID  == "7" ~  "Combo",
                     Q_12.1_ID  == "Combo (1,5)" ~  "Combo",
                     Q_12.1_ID  == "8" ~  "Don't test",
                     Q_12.1_ID  == "9" ~  "Unspecified/random",
                     Q_12.1_ID  == "0" ~  "NA"))

data_q12_1summary_agro <- filter (data_q12_1, Resp_Group == "Agronomist" & names_display !=  "NA")%>%
  group_by(Resp_Group) %>%
  count(names_display) %>% 
  mutate(percent = 
           (freq = n / sum(n))) %>% 
  arrange(desc(percent))

add_lines <- tibble (Resp_Group = c("Agronomist"),
                     names_display = c("Deep"),
                     n = c(0),
                     percent = c(0))


data_q12_1summary_agro1 <- full_join(data_q12_1summary_agro, add_lines)
data_q12_1summary_agro1


data_q12_1summary_grower <- filter (data_q12_1, Resp_Group == "Grower" & names_display !=  "NA")%>%
  group_by(Resp_Group) %>% 
  count(names_display) %>% 
  mutate(percent = 
           (freq = n / sum(n))) %>% 
  arrange(desc(percent))



data_q12_1summary_agro_grower <- rbind(data_q12_1summary_agro1,data_q12_1summary_grower )
data_q12_1summary_agro_grower
unique(data_q12_1summary_agro_grower$names_display)

data_q12_1summary_agro_grower<- mutate(data_q12_1summary_agro_grower, names_display = fct_relevel(names_display, 
                                                                                        c("Programs",
                                                                                          "Shallow", 
                                                                                          "Unspecified/random",
                                                                                          "All depths",
                                                                                          "Combo",
                                                                                          "Yield maps",
                                                                                          "Cowell P",
                                                                                          "Don't test",
                                                                                          "Deep")))



```






```{r graph and table- Q12.1 source of advice agro, echo=FALSE, message=FALSE, warning=TRUE}

datatable(data_q12_1summary_agro_grower,
            options = list(pageLength = 35, dom = 't'),
            # caption = "Grower",
             colnames = c( "Respondent" = "Resp_Group",
                           "Approach" = "names_display",
                           "count" = "n",
                           "percent" = "percent")) %>%
  formatPercentage(c("percent"), 0)

ggplot(data_q12_1summary_agro_grower, aes(names_display , percent, fill = Resp_Group  )) +
  scale_fill_manual(values=c("grey70", "grey40"))+
  geom_col()+
  facet_wrap(. ~ Resp_Group)+
  #geom_text(aes(label = percent(signif(percent),1), vjust = -1.0, hjust = 0.5))+
  theme_classic()+
  labs(x= "",
       y = "",
       fill = "",
       title = "Explain your approach to soil testing P?",
       subtitle = "",
       caption = "Q) Explain your approach to soil testing P?")+
  theme(axis.text.x=element_text(angle=45,hjust=1),
        plot.caption = element_text(size = 8),
        legend.position =  "") + 
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L), limits=c(0, 0.5))


```







```{r Q12.2 source of advice agro, message=FALSE, warning=TRUE, include=FALSE}


headers12_2 <- read_excel("Q12_ Assigning_Category ID_22.10.19.xlsx", 
                       sheet = "Q12.2", col_names=FALSE, range = "B4:E4")

head(headers12_2)

data_q12_2 <- read_excel("Q12_ Assigning_Category ID_22.10.19.xlsx", 
                       sheet = "Q12.2", col_names=FALSE, range = "B5:E174")
names(data_q12_2) <- headers12_2

head(data_q12_2)
data_q12_2 <- mutate(data_q12_2,
                   names_display =case_when(
                     Q_12.2_ID == "1" ~  "Shallow",
                     Q_12.2_ID  == "2" ~  "Cowell P",
                     Q_12.2_ID  == "3" ~  "Deep",
                     Q_12.2_ID  == "4" ~  "All depths",
                     Q_12.2_ID  == "5" ~  "Yield maps",
                     Q_12.2_ID  == "6" ~  "Programs",
                     Q_12.2_ID  == "7" ~  "Combo",
                     Q_12.2_ID  == "Combo (1,5)" ~  "Combo",
                     Q_12.2_ID  == "8" ~  "Don't test",
                     Q_12.2_ID  == "9" ~  "Unspecified/random",
                     Q_12.2_ID  == "0" ~  "NA"))



data_q12_2summary_agro <- filter (data_q12_2, Resp_Group == "Agronomist" & names_display !=  "NA")%>%
  group_by(Resp_Group) %>%
  count(names_display) %>% 
  mutate(percent = 
           (freq = n / sum(n))) %>% 
  arrange(desc(percent))

data_q12_2summary <- filter (data_q12_2, Resp_Group == "Grower" & names_display !=  "NA")%>%
  group_by(Resp_Group) %>%
  count(names_display) %>% 
  mutate(percent = 
           (freq = n / sum(n))) %>% 
  arrange(desc(percent))

data_q12_2summary
data_q12_2summary_agro
data_q12_2summary_agro_grower <- rbind(data_q12_2summary, data_q12_2summary_agro)

data_q12_2summary_agro_grower<- mutate(data_q12_2summary_agro_grower, names_display = fct_relevel(names_display, 
                                                                          c("Deep",
                                                                            "All depths",
                                                                            "Programs",
                                                                            "Unspecified/random",
                                                                            "Don't test",
                                                                            "Yield maps",
                                                                            "Combo",
                                                                            "Shallow")))

```

```{r graph and Table- Q12.2 source of advice agro, echo=FALSE, message=FALSE, warning=TRUE}


datatable(data_q12_2summary_agro_grower,
          options = list(pageLength = 35, dom = 't'),
          # caption = "Grower",
          colnames = c( "Respondent" = "Resp_Group",
                        "Approach" = "names_display",
                        "count" = "n",
                        "percent" = "percent")) %>%
  formatPercentage(c("percent"), 0)

# data_q12_3summary_agro_grower %>% 
#   group_by(Resp_Group) %>% 
# summarise(sum = sum(n))



ggplot(data_q12_2summary_agro_grower, aes(names_display , percent, fill = Resp_Group ))+
  scale_fill_manual(values=c("grey70", "grey40"))+
  geom_col()+
  facet_wrap(. ~ Resp_Group)+
  theme_classic()+
  labs(x= "",
       y = "",
       fill = "",
       title = "Explain your approach to soil testing N?",
       subtitle = "",
       caption = "Q) Explain your approach to soil testing N?")+
  theme(axis.text.x=element_text(angle=45,hjust=1),
        plot.caption = element_text(size = 8),
        legend.position =  "") + 
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L), limits=c(0, 0.5))

```





```{r Q12.3 source of advice both, message=FALSE, warning=TRUE, include=FALSE}


headers12_3 <- read_excel("Q12_ Assigning_Category ID_22.10.19.xlsx", 
                       sheet = "Q12.3", col_names=FALSE, range = "B4:E4")

head(headers12_3)

data_q12_3 <- read_excel("Q12_ Assigning_Category ID_22.10.19.xlsx", 
                       sheet = "Q12.3", col_names=FALSE, range = "B5:E174")
names(data_q12_3) <- headers12_3



head(data_q12_3)
data_q12_3 <- mutate(data_q12_3,
                   names_display =case_when(
                     Q_12.3_ID == "1" ~  "Shallow",
                     Q_12.3_ID  == "2" ~  "NA",
                     Q_12.3_ID  == "3" ~  "NA",
                     Q_12.3_ID  == "4" ~  "All depths",
                     Q_12.3_ID  == "5" ~  "Yield maps",
                     Q_12.3_ID  == "6" ~  "Programs",
                     Q_12.3_ID  == "7" ~  "Combo",
                     Q_12.3_ID  == "Combo (1,5)" ~  "Combo",
                     Q_12.3_ID  == "8" ~  "Don't test",
                     Q_12.3_ID  == "9" ~  "Unspecified/random",
                     Q_12.3_ID  == "0" ~  "NA",
                     Q_12.3_ID  == "10" ~  "Plant",
                     Q_12.3_ID  == "11" ~  "Soil & Plant"))






data_q12_3summary_agro <- filter (data_q12_3, Resp_Group == "Agronomist" & names_display !=  "NA")%>%
  group_by(Resp_Group) %>%
  count(names_display) %>% 
  mutate(percent = 
           (freq = n / sum(n))) %>% 
  arrange(desc(percent))

data_q12_3summary_agro


add_lines <- tibble (Resp_Group = c("Agronomist"),
                     names_display = c("Yield maps"),
                     n = c(0),
                     percent = c(0))

data_q12_1summary_agro1 <- full_join(data_q12_3summary_agro, add_lines)


data_q12_3summary_grower <- filter (data_q12_3, Resp_Group == "Grower" & names_display !=  "NA")%>%
  group_by(Resp_Group) %>%
  count(names_display) %>% 
  mutate(percent = 
           (freq = n / sum(n))) %>% 
  arrange(desc(percent))

add_lines_g <- tibble (Resp_Group = c("Grower", "Grower"),
                     names_display = c("All depths","Shallow" ),
                     n = c(0, 0),
                     percent = c(0, 0))
data_q12_3summary_grower1 <- full_join(data_q12_3summary_grower, add_lines_g)
unique(data_q12_1summary_agro1$names_display)
unique(data_q12_3summary_grower1$names_display)
dim(data_q12_1summary_agro1)
dim(data_q12_3summary_grower1)

data_q12_3summary_agro_grower <- rbind(data_q12_1summary_agro1, data_q12_3summary_grower1)

unique(data_q12_3summary_agro_grower$names_display)
data_q12_3summary_agro_grower<- mutate(data_q12_3summary_agro_grower, names_display = fct_relevel(names_display, 
                                                                                        c("Plant",
                                                                                          "Soil & Plant",
                                                                                          "Unspecified/random",
                                                                                          "Programs",
                                                                                          "All depths",
                                                                                          "Don't test",
                                                                                          "Shallow", 
                                                                                          "Combo",
                                                                                          "Yield maps")))

```

```{r graph and table - Q12.3 source of advice both, echo=FALSE, message=FALSE, warning=TRUE}







ggplot(data_q12_3summary_agro_grower, aes(names_display , percent, fill= Resp_Group ))+
  geom_col()+
  scale_fill_manual(values=c("grey70", "grey40"))+
  facet_wrap(.~ Resp_Group)+
  theme_classic()+
  labs(x= "",
       y = "",
       fill = "",
       title = "Explain your approach to soil testing micronutrients?",
       subtitle = "Agronomist only",
       caption = "Q) Explain your approach to soil testing micronutrients?")+
  theme(axis.text.x=element_text(angle=45,hjust=1),
        plot.caption = element_text(size = 8),
        legend.position =  "") + 
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L), limits=c(0, 0.5))

```


```{r Q12.3 source of advice grower, message=FALSE, warning=TRUE, include=FALSE}

data_q12_3summary_grower <- filter (data_q12_3, Resp_Group == "Grower" & names_display !=  "NA")%>%
  count(names_display) %>% 
  mutate(percent = 
           (freq = n / sum(n))) %>% 
  arrange(desc(percent))


data_q12_3summary_grower<- mutate(data_q12_3summary_grower, names_display = fct_relevel(names_display, 
                                                                          c("Plant",
                                                                            "Soil & Plant",
                                                                            "Unspecified/random",
                                                                            "Programs",
                                                                            #"All depths",
                                                                            "Don't test",
                                                                            #"Shallow", 
                                                                            "Combo",
                                                                            "Yield maps")))
#
```

```{r graph - Q12.3 source of advice grower, echo=FALSE, message=FALSE, warning=TRUE}
ggplot(data_q12_3summary_grower, aes(names_display , percent ))+
  geom_col(fill = "grey40", color = "black")+
  theme_classic()+
  labs(x= "",
       y = "",
       fill = "",
       title = "Explain your approach to soil testing micronutrients?",
       subtitle = "Grower only",
       caption = "Q) Explain your approach to soil testing micronutrients?")+
  theme(axis.text.x=element_text(angle=45,hjust=1),
        plot.caption = element_text(size = 8)) + 
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L), limits=c(0, 0.5))

```

##### Comments on question 12

* The response from survey participants changes with the 3 questions.
* For P testing - 56 agronomists responded and 42 growers
* For N testing - 52 agronomists responded and 45 growers
* For Micro nutrients testing - 41 agronomists responded and 25 growers
The percentages are expressed using the above total (i.e. for the participants that answered the question)

#### **Question 13** 


Agronomist)

Can you please provide some specific information on ..

* What % of your clients soil tested in 2018? (any testing)
* What % of your clients tested for N in 2018? (N)
* What % of your clients tested for N to at least 60cm in 2018?
* What % of your clients tested for P in 2018? (P)

Note for this question agronomist were asked to nominate a bin.

* 0
* 10-15%
* 15-20%
* 5-10%
* 50 -100%

Grower)

Can you please provide some specific information on ..

* What % of  your cropped land was soil tested in 2018 (any testing)
* What % of your cropped land was tested for N in 2018? (N)
* What % of your cropped land was tested for N to at least 60cm in 2018?
* What % of your cropped land was tested for P in 2018? (P)

Note for this question agronomist were asked to nominate a bin.

* 0
* 10-15%
* 15-20%
* 5-10%
* 50 -100%

Note the data set has NA these are not displayed in the graphs
But they have been included in the analysis for the counts.



```{r Q13 data work up and DT summary, include=FALSE}

data_agro <- filter(data, Resp_Group == "Agronomist" )

#check out if we have any missing data for this question
  #data_agro %>% group_by(Resp_Group) %>%
  #         summarise(sum(is.na(Q_13.1)))

data_grower <- filter(data, Resp_Group == "Grower" )


### Run anlayis(perecnatge) for 'any soil testing' do this for argonomist and grower seperately and then join data frame together

#step1
Q13_percent_testing_2018_agro <- data_agro %>%
  filter(!is.na(Q_13.1)) %>% #this removes the na from the anlaysis
  group_by( Q_13.1 ) %>%
  summarise(n = n()) %>%
  mutate(percent = (freq = n / sum(n)),
         type = "percent_testing_2018",
         Resp_Group = "Agronomist")
#step2
#this step is just selecting the data I want and giving the clms a standard name
Q13_percent_testing_2018_agro <- Q13_percent_testing_2018_agro %>%
  select(n,
        percent,
        type,
        bins = Q_13.1,
        Resp_Group)

Q13_percent_testing_2018_grower <- data_grower %>%
  filter(!is.na(Q_13.1)) %>% #this removes the na from the anlaysis
  group_by( Q_13.1 ) %>%
  summarise(n = n()) %>%
  mutate(percent = (freq = n / sum(n)),
         type = "percent_testing_2018",
         Resp_Group = "Grower")
Q13_percent_testing_2018_grower <- Q13_percent_testing_2018_grower %>%
  select(n,
        percent,
        type,
        bins = Q_13.1,
        Resp_Group)

Q13_percent_testing_2018 <- rbind(Q13_percent_testing_2018_agro, Q13_percent_testing_2018_grower)
#tail(Q13_percent_testing_2018)

#Q13.2
### Run anlayis(perecnatge) for '% of cropped land getting soil test' do this for argonomist and grower seperately and then join data frame together
#step1 - agro
Q13_percent_N_testing_2018_argo <- data_agro %>%
  filter(!is.na(Q_13.2)) %>% #this removes the na from the anlaysis
  group_by(  Q_13.2  ) %>%
  summarise(n = n()) %>%
  mutate(percent =(freq = n / sum(n)),
         type = "percent_N_testing_2018",
         Resp_Group = "Agronomist")
#step2 - agro
Q13_percent_N_testing_2018_argo <- Q13_percent_N_testing_2018_argo %>%
  select(n,
         percent,
         type,
         bins = Q_13.2,
         Resp_Group)
Q13_percent_N_testing_2018_grower <- data_grower %>%
  filter(!is.na(Q_13.2)) %>% #this removes the na from the anlaysis
  group_by(  Q_13.2  ) %>%
  summarise(n = n()) %>%
  mutate(percent =(freq = n / sum(n)),
         type = "percent_N_testing_2018",
         Resp_Group = "Grower")
Q13_percent_N_testing_2018_grower <- Q13_percent_N_testing_2018_grower %>%
  select(n,
         percent,
         type,
         bins = Q_13.2,
         Resp_Group)

Q13_percent_N_testing_2018 <- rbind(Q13_percent_N_testing_2018_argo, Q13_percent_N_testing_2018_grower)
#tail(Q13_percent_N_testing_2018)

#Q13.4
### Run anlayis(perecnatge) for '% of cropped land tested for P' do this for argonomist and grower seperately and then join data frame together
#step1 - agro
Q13_percent_P_testing_2018_argo <- data_agro %>%
  filter(!is.na(Q_13.4)) %>% #this removes the na from the anlaysis
  group_by(Q_13.4) %>%
  summarise(n = n()) %>%
  mutate(percent =(freq = n / sum(n)),
         type = "percent_P_testing_2018",
         Resp_Group = "Agronomist")
#step2 - agro
Q13_percent_P_testing_2018_argo <- Q13_percent_P_testing_2018_argo %>%
  select(n,
         percent,
         type,
         bins = Q_13.4,
         Resp_Group)
temp <- rbind(Q13_percent_testing_2018,
              Q13_percent_N_testing_2018)

temp <- rbind(temp,
              Q13_percent_P_testing_2018_argo)


Q13_percent_P_testing_2018_grower <- data_grower %>%
  filter(!is.na(Q_13.4)) %>% #this removes the na from the anlaysis
  group_by(  Q_13.4  ) %>%
  summarise(n = n()) %>%
  mutate(percent =(freq = n / sum(n)),
         type = "percent_P_testing_2018",
         Resp_Group = "Grower")
Q13_percent_P_testing_2018_grower <- Q13_percent_P_testing_2018_grower %>%
  select(n,
         percent,
         type,
         bins = Q_13.4,
         Resp_Group)

head(Q13_percent_P_testing_2018_grower)

Q13_percent_testing <- rbind(temp,
              Q13_percent_P_testing_2018_grower)


#print(Q13_percent_testing)

Q13_percent_testing <- select(Q13_percent_testing,
                              type,
                              bins,
                              percent, n, Resp_Group)      
#head(Q13_percent_testing) 


labels <- c(percent_N_testing_2018 = "N", 
            percent_P_testing_2018 = "P",
            percent_testing_2018 = "testing")


#head(Q12_percent_testing)
Q13_percent_testing_for_table <- mutate(Q13_percent_testing,
                                        percent1 = round(percent,2),
                                        label_name = case_when(
                                          type == "percent_N_testing_2018" ~ "N",
                                          type == "percent_P_testing_2018" ~ "P",
                                          type == "percent_testing_2018" ~ "any testing")) %>% 
                                select(label_name, bins, percent1, Resp_Group, n )





```

```{r Q13 graphs and table, echo=FALSE, warning=TRUE}
##Table
#Q13_percent_testing_for_table


select(Q13_percent_testing_for_table,Resp_Group, label_name, bins,  n, percent1 ) %>% 
  filter(Resp_Group == "Agronomist" ) %>% 
datatable( 
          colnames = c("Type of test" =  "label_name", 
                       "Respondent" = "Resp_Group", 
                       "percent" = "percent1", 
                       "count" = "n"), 
          options = list(pageLength = 35,  dom = 't'),
          caption = "Agronomist") %>% 
  formatPercentage('percent', 0)


select(Q13_percent_testing_for_table,Resp_Group, label_name, bins,  n, percent1 ) %>% 
  filter(Resp_Group == "Grower" ) %>% 
datatable( 
          colnames = c("Type of test" =  "label_name", 
                       "Respondent" = "Resp_Group", 
                       "percent" = "percent1", 
                       "count" = "n"), 
          options = list(pageLength = 35,  dom = 't'),
          caption = "Grower") %>% 
  formatPercentage('percent', 0)

#Captions and labels
caption_agro <- c(
"Q) What % of your clients soil tested in 2018?
Q) What % of your clients tested for N in 2018?
Q) What % of your clients tested for P in 2018?")

caption_grower <- c(
"Q) What % of  your cropped land was soil tested in 2018?
Q) What % of your cropped land was tested for N in 2018?
Q) What % of your cropped land was tested for P in 2018?")


#get the correct order for my labeles
 Q13_percent_testing <- mutate(Q13_percent_testing,
                                bin_as_factors = case_when(
                                  bins == "0" ~ 0,
                                  bins == "5-10%" ~ 5,
                                  bins == "10-15%" ~ 10,
                                  bins == "15-20%" ~ 15,
                                  bins == "20-50%" ~ 20,
                                  bins == "50-100%" ~ 50
                                ))
  Q13_percent_testing$bin_as_factors <- factor(Q13_percent_testing$bin_as_factors,
                                        levels=c(0,5,10,15,20,50),
                                        labels=c("0","5-10%","10-15%","15-20%", "20-50%", "50-100%")) 
  
  

 ### plots 
  
  filter(Q13_percent_testing, bin_as_factors != "NA" &
           Resp_Group == "Agronomist") %>% 
    ggplot( aes(bin_as_factors, percent))+
    geom_col(fill = "grey70", color = "black")+
    theme_classic()+
    facet_wrap(. ~ type, labeller=labeller(type = labels)) +  
    labs(x= "bins",
         y = "",
         title = "In 2018 what % of your clients tested...",
         subtitle = "Agronomist",
         caption = caption_agro)+
    theme(axis.text.x=element_text(angle=90,hjust=1),
          plot.caption = element_text(size = 8, hjust = 0))+
    scale_y_continuous(labels = scales::percent_format(accuracy = 5L), limits=c(0, 0.4))

  
  
  filter(Q13_percent_testing, bin_as_factors != "NA" &
           Resp_Group == "Grower") %>% 
    ggplot( aes(bin_as_factors, percent))+
    geom_col(fill = "grey40", color = "black")+
    theme_classic()+
    facet_wrap(. ~ type, labeller=labeller(type = labels)) +  
    labs(x= "bins",
         y = "",
         title = "In 2018 what % of your cropped land was tested...",
         subtitle = "Grower",
         caption = caption_grower)+
    theme(axis.text.x=element_text(angle=90,hjust=1),
          plot.caption = element_text(size = 8, hjust = 0))+
    scale_y_continuous(labels = scales::percent_format(accuracy = 5L), limits=c(0, 0.4))
```


```{r Q13 grouping other options, include=FALSE}



subset_soil_testQ_13 <- select(data, Resp_Group, Q_13.1, Q_13.2, Q_13.4)
subset_soil_testQ_13 <- filter(subset_soil_testQ_13, Q_13.1 != "NA") #this takes out all the na
#Recode to only have 50% or more

#table(subset_soil_testQ_13)
subset_soil_testQ_13 <- mutate(subset_soil_testQ_13,
                              recode_13.1 = case_when(
                                Q_13.1 == "50-100%" ~ "more than half",
                                #Q_13.1 == "0" ~ "less than 20%",
                                Q_13.1 == "10-15%" ~ "less than 20%",
                                Q_13.1 == "15-20%" ~ "less than 20%",
                                Q_13.1 == "0" ~ "Zero",
                                 TRUE  ~ "other"
                                ))

subset_soil_testQ_13 <- mutate(subset_soil_testQ_13,
                               recode_13.2 = case_when(
                                 Q_13.2 == "50-100%" ~ "more than half",
                                 #Q_13.2 == "0" ~ "less than 20%",
                                 Q_13.2 == "10-15%" ~ "less than 20%",
                                 Q_13.2 == "15-20%" ~ "less than 20%",
                                 Q_13.2 == "0" ~ "Zero",
                                  TRUE  ~ "other"
                               ))

subset_soil_testQ_13 <- mutate(subset_soil_testQ_13,
                               recode_13.4 = case_when(
                                 Q_13.4 == "50-100%" ~ "more than half",
                                 #Q_13.4 == "0" ~ "less than 20%",
                                 Q_13.4 == "10-15%" ~ "less than 20%",
                                 Q_13.4 == "15-20%" ~ "less than 20%",
                                 Q_13.4 == "0" ~ "Zero",
                                  TRUE  ~ "other"
                               ))
#head(subset_soil_testQ_13)
subset_soil_testQ_13_agro <- filter(subset_soil_testQ_13, Resp_Group == "Agronomist" )
subset_soil_testQ_13_grower <- filter(subset_soil_testQ_13, Resp_Group == "Grower" )

#any test agro and grower sep and then join
subset_soil_testQ_13_agro_test <- subset_soil_testQ_13_agro %>%  
  group_by(   recode_13.1  ) %>%
  summarise(n = n()) %>%
  mutate(percent =(freq = n / sum(n)),
         type = "percent_testing_2018",
         Resp_Group = "Agronomist")
subset_soil_testQ_13_agro_test <- subset_soil_testQ_13_agro_test %>%
  select(n,
         percent,
         type,
         bins = recode_13.1,
         Resp_Group)

subset_soil_testQ_13_grower_test <- subset_soil_testQ_13_grower %>%  
  group_by(   recode_13.1  ) %>%
  summarise(n = n()) %>%
  mutate(percent =(freq = n / sum(n)),
         type = "percent_testing_2018",
         Resp_Group = "Grower")
subset_soil_testQ_13_grower_test <- subset_soil_testQ_13_grower_test %>%
  select(n,
         percent,
         type,
         bins = recode_13.1,
         Resp_Group)

subset_soil_testQ_13_test <- rbind(subset_soil_testQ_13_grower_test, subset_soil_testQ_13_agro_test)


#N test agro and grower sep and then join
subset_soil_NQ_13_agro_test <- subset_soil_testQ_13_agro %>%  
  group_by(   recode_13.2  ) %>%
  summarise(n = n()) %>%
  mutate(percent =(freq = n / sum(n)),
         type = "percent_N_testing_2018",
         Resp_Group = "Agronomist")
subset_soil_NQ_13_agro_test <- subset_soil_NQ_13_agro_test %>%
  select(n,
         percent,
         type,
         bins = recode_13.2,
         Resp_Group)

subset_soil_testNQ_13_grower_test <- subset_soil_testQ_13_grower %>%  
  group_by(   recode_13.2  ) %>%
  summarise(n = n()) %>%
  mutate(percent =(freq = n / sum(n)),
         type = "percent_N_testing_2018",
         Resp_Group = "Grower")
subset_soil_testNQ_13_grower_test <- subset_soil_testNQ_13_grower_test %>%
  select(n,
         percent,
         type,
         bins = recode_13.2,
         Resp_Group)

subset_soil_N_testQ_13_test <- rbind(subset_soil_testNQ_13_grower_test, subset_soil_NQ_13_agro_test)


#P test agro and grower sep and then join
subset_soil_PQ_13_agro_test <- subset_soil_testQ_13_agro %>%  
  group_by(   recode_13.4  ) %>%
  summarise(n = n()) %>%
  mutate(percent =(freq = n / sum(n)),
         type = "percent_P_testing_2018",
         Resp_Group = "Agronomist")
subset_soil_PQ_13_agro_test <- subset_soil_PQ_13_agro_test %>%
  select(n,
         percent,
         type,
         bins = recode_13.4,
         Resp_Group)

subset_soil_testPQ_13_grower_test <- subset_soil_testQ_13_grower %>%  
  group_by(   recode_13.4  ) %>%
  summarise(n = n()) %>%
  mutate(percent =(freq = n / sum(n)),
         type = "percent_P_testing_2018",
         Resp_Group = "Grower")
subset_soil_testPQ_13_grower_test <- subset_soil_testPQ_13_grower_test %>%
  select(n,
         percent,
         type,
         bins = recode_13.4,
         Resp_Group)

subset_soil_P_testQ_13_test <- rbind(subset_soil_testPQ_13_grower_test, subset_soil_PQ_13_agro_test)
subset_soil_P_testQ_13_test
subset_soil_testQ_13_narrow <- rbind(subset_soil_testQ_13_test, subset_soil_N_testQ_13_test, subset_soil_P_testQ_13_test)

# get the format I am after I need to make each data frame wide and then join togther
subset_soil_testQ_13_test_wide <- spread(subset_soil_testQ_13_test, key = type, value = percent) %>% mutate(id= paste0(Resp_Group, "_", bins))
subset_soil_N_testQ_13_test_wide <- spread(subset_soil_N_testQ_13_test, key = type, value = percent)%>% mutate(id= paste0(Resp_Group, "_", bins))
subset_soil_P_testQ_13_test_wide <- spread(subset_soil_P_testQ_13_test, key = type, value = percent)%>% mutate(id= paste0(Resp_Group, "_", bins))

### Add a clm for count
subset_soil_testQ_13_test_wide <- mutate(subset_soil_testQ_13_test_wide, test = n)
subset_soil_N_testQ_13_test_wide <- mutate(subset_soil_N_testQ_13_test_wide, n_test = n)
subset_soil_P_testQ_13_test_wide <- mutate(subset_soil_P_testQ_13_test_wide, p_test = n)


subset_soil_N_P_Any_Q_13_wide <- left_join(subset_soil_testQ_13_test_wide, 
                                           subset_soil_N_testQ_13_test_wide,
                                           subset_soil_P_testQ_13_test_wide,
                                           by = "id")


subset_soil_N_P_Any_Q_13_wide <-  subset_soil_testQ_13_test_wide %>%
                                  left_join(subset_soil_N_testQ_13_test_wide, by='id') %>%
                                  left_join(subset_soil_P_testQ_13_test_wide, by='id')

#print(subset_soil_N_P_Any_Q_13_wide$percent_P_testing_2018)
subset_soil_N_P_Any_Q_13_wide <- select( subset_soil_N_P_Any_Q_13_wide,
                                         bins = bins.x,
                                         Resp_Group = Resp_Group.x,
                                         percent_testing_2018,
                                         percent_N_testing_2018,
                                         percent_P_testing_2018,
                                         test,
                                         n_test, 
                                         p_test
                                         )

subset_soil_N_P_Any_Q_13_wide <- mutate_if(subset_soil_N_P_Any_Q_13_wide,
                                           is.double, round,2)

```



```{r graph - Q13 grouping other options, echo=FALSE}

#subset_soil_N_P_Any_Q_13_wide

filter(subset_soil_N_P_Any_Q_13_wide, Resp_Group == "Agronomist") %>%
  datatable(
    colnames = c(
      "bins" =  "bins",
      "respondent" = "Resp_Group",
      "testing" = "percent_testing_2018",
      "N" = "percent_N_testing_2018",
      "P" = "percent_P_testing_2018",
      "count test" = "test",
      "count N test" = "n_test",
      "count P test" = "p_test"
    ),
    options = list(pageLength = 35,  dom = 't'),
    caption = "Agronomist"
  ) %>%
  
  formatPercentage(c("testing",
                     "N",
                     "P"))


filter(subset_soil_N_P_Any_Q_13_wide, Resp_Group == "Grower") %>%
  datatable(
    colnames = c(
      "bins" =  "bins",
      "respondent" = "Resp_Group",
      "testing" = "percent_testing_2018",
      "N" = "percent_N_testing_2018",
      "P" = "percent_P_testing_2018",
      "count test" = "test",
      "count N test" = "n_test",
      "count P test" = "p_test"
    ),
    options = list(pageLength = 35,  dom = 't'),
    caption = "Grower"
  ) %>%
  
  formatPercentage(c("testing",
                     "N",
                     "P"))

######
filter(subset_soil_testQ_13_narrow, bins != "other" &
           Resp_Group == "Grower") %>% 
    ggplot( aes(bins, percent))+
    geom_col(fill = "grey40", color = "black")+
    #geom_text(aes(label = percent(signif(percent),1), vjust = -1.0, hjust = 0.5))+
    theme_classic()+
    facet_wrap(. ~ type, labeller=labeller(type = labels)) +  
    labs(x= "bins",
         y = "",
         title = "In 2018 what % of your cropped land was tested...",
         subtitle = "Grower",
         caption = caption_grower)+
    theme(axis.text.x=element_text(angle=90,hjust=1),
          plot.caption = element_text(size = 8, hjust = 0))+
    scale_y_continuous(labels = scales::percent_format(accuracy = 5L), limits=c(0, 0.4))

filter(subset_soil_testQ_13_narrow, bins != "other" &
           Resp_Group == "Agronomist") %>% 
    ggplot( aes(bins, percent))+
    geom_col(fill = "grey70", color = "black")+
    #geom_text(aes(label = percent(signif(percent),1), vjust = -1.0, hjust = 0.5))+
    theme_classic()+
    facet_wrap(. ~ type, labeller=labeller(type = labels)) +  
    labs(x= "bins",
         y = "",
         title = "In 2018 what % of your cropped land was tested...",
         subtitle = "Agronomist",
         caption = caption_grower)+
    theme(axis.text.x=element_text(angle=90,hjust=1),
          plot.caption = element_text(size = 8, hjust = 0))+
    scale_y_continuous(labels = scales::percent_format(accuracy = 5L), limits=c(0, 0.4))

```



##### Comments on question 12

* I have tried to take out the percentage of percentage graph


* Agronomists with more than half of clients soil testing in 2018 
* Agronomists with less than 20% of clients  soil testing in 2018 
* Agronomists with no clients soil testing in 2018

* Growers with more than half of clients soil testing in 2018 
* Growers with less than 20% of clients  soil testing in 2018 
* Growers with no clients soil testing in 2018

Note that for this analysis I have removed the NA values before re classing the bins
I have another bin called 'other' which is used to get the percentage, this includes 5-10% grouping.
This just mean that I am calculating the percentage based on all the respondents (but not the NA)
In the table you can see the bin called other, but I have not displayed it in the graphs.

Hope this is clear - not sure if this is what you were after?





#### **Question 14 N**

Grower:

Which tests do you currently use for soil N testing?

* Nitrogen 1 - Type of test
* Nitrogen 1 - Frequency (times per season)
* Nitrogen 1 - How many representative samples per paddock
* Nitrogen 2 - Type of test
* Nitrogen 2 - Frequency (times per season)
* Nitrogen 2 - How many representative samples per paddock
* Nitrogen 3 - Type of test
* Nitrogen 3 - Frequency (times per season)
* Nitrogen 3 - How many representative samples per paddock
* How frequently are paddocks tested i.e. every 3 years, every 5 years ... other?


```{r soil test function, include=FALSE}

#Define a function that can be used for many similar questions...

soil_test_use <- function(data_df, test1, numb_sample_test1, 
                        test2, numb_sample_test2,
                        test3, numb_sample_test3,
                        name, soil_test) {
  #test1
  subset_test1 <-
    select(data_df, !! test1, !! numb_sample_test1, Resp_Group, `Respondent ID`)
  
  colnames(subset_test1)[1] <- "test"
  colnames(subset_test1)[2] <- "numb_of_test"
  
  test1 <- subset_test1 %>%
    mutate(test  =
             case_when(test == soil_test ~ soil_test))
  
  #test2
  subset_test2 <-
    select(data_df, !! test2, !! numb_sample_test2, Resp_Group, `Respondent ID`)
  
  colnames(subset_test2)[1] <- "test"
  colnames(subset_test2)[2] <- "numb_of_test"
  
  test2 <- subset_test2 %>%
    mutate(test  =
             case_when(test == soil_test ~ soil_test))
  
  #test3
  subset_test3 <-
    select(data_df, !! test3, !! numb_sample_test3, Resp_Group, `Respondent ID`)
  
  colnames(subset_test3)[1] <- "test"
  colnames(subset_test3)[2] <- "numb_of_test"
  
  test3 <- subset_test3 %>%
    mutate(test  =
             case_when(test == soil_test ~ soil_test))
  
  # merge all the test togther
  test_all_clm <-bind_rows(test1, test2, test3)
  
  #return(test_all_clm)
  return(assign(name,test_all_clm,envir = .GlobalEnv))
  
} 

```

```{r use soil test function on Q14 N, include=FALSE}

#inputs are the 6clms that contain the data and the test used 
#"Organic Carbon", "Total N", "Mineral N (Nitrate/Ammonium)"
soil_test_use(data, quo(Q_14.1.1), quo(Q_14.1.3), 
                    quo(Q_14.2.1), quo(Q_14.2.3),
                    quo(Q_14.3.1), quo(Q_14.3.3),
                    "test_OC", "Organic Carbon")
soil_test_use(data, quo(Q_14.1.1), quo(Q_14.1.3), 
                    quo(Q_14.2.1), quo(Q_14.2.3),
                    quo(Q_14.3.1), quo(Q_14.3.3),
                    "test_MN", "Mineral N (Nitrate/Ammonium)")
soil_test_use(data, quo(Q_14.1.1), quo(Q_14.1.3), 
                    quo(Q_14.2.1), quo(Q_14.2.3),
                    quo(Q_14.3.1), quo(Q_14.3.3),
                    "test_TN", "Total N")
#count the number of people using this test and join 
OC <- test_OC %>%
  filter(!is.na(test)) %>%
  group_by( Resp_Group) %>%
  count(test) 
MN <- test_MN %>%
  filter(!is.na(test)) %>%
  group_by( Resp_Group) %>%
  count(test)
TN <- test_TN %>%
  filter(!is.na(test)) %>%
  group_by( Resp_Group) %>%
  count(test)
N_test_counts <- rbind(OC, MN, TN)
#Add in how many people in each group to cal the %
N_test_counts <- N_test_counts %>% 
  mutate(Resp_numb = case_when(
    Resp_Group == "Agronomist" ~ 71,
    Resp_Group == "Grower"  ~ 99
  ),
percent = n/Resp_numb
    )
N_test_counts
### number of people sampling at certain density number of samples per paddock
OC_numb <- test_OC %>%
  filter(!is.na(numb_of_test)) %>%
  group_by( Resp_Group) %>%
  count(numb_of_test) 
MN_numb <- test_MN %>%
  filter(!is.na(numb_of_test)) %>%
  group_by( Resp_Group) %>%
  count(numb_of_test)
TN_numb <- test_TN %>%
  filter(!is.na(numb_of_test)) %>%
  group_by( Resp_Group) %>%
  count(numb_of_test)
N_test_numb_counts <- rbind(OC_numb, MN_numb, TN_numb)
N_test_numb_counts <- N_test_numb_counts %>% 
  mutate(Resp_numb = case_when(
    Resp_Group == "Agronomist" ~ 71,
    Resp_Group == "Grower"  ~ 99
  ),
percent = n/Resp_numb
    )
N_test_numb_counts

```


```{r Q14 data graphs N, echo=FALSE}
#Table
select(N_test_counts,Resp_Group, test , n,   percent) %>%
datatable( colnames = c("Respondent" = "Resp_Group",
                        "count" = "n",
                         "test" = "test" ,
                         "percent" = "percent" ),
           options = list(pageLength = 35,  dom = 't'))%>%
     formatPercentage(c("percent"
                        ))

#percent of people in survey using certain test
ggplot(N_test_counts, aes (x = test, y = percent, fill = Resp_Group))+
  geom_col()+
  scale_fill_manual(values=c("grey70", "grey40"))+
  facet_wrap(.~ Resp_Group )+
  theme_classic()+
  labs(x= "",
       y = "",
       title = "N test used",
       subtitle = "",
       caption = "Q)  Which tests do you currently use for your soil N testing?")+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(size = 8), legend.position = "none") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L)) 


# df needs ording for display
N_test_numb_counts$numb_of_test <- factor(N_test_numb_counts$numb_of_test,levels = c("0-5",  "5-10", "10-15", 
                                                                                             "15-20", "20-25",  "25-30", 
                                                                                             "greater than 30"))

#percent of people in survey using sampling at certain density - number of samples per paddock
ggplot(N_test_numb_counts, aes (x = numb_of_test, y = percent, fill = Resp_Group))+
  geom_col()+
  scale_fill_manual(values=c("grey70", "grey40"))+
  facet_wrap(.~ Resp_Group )+
  theme_classic()+
  labs(x= "Number of samples per paddock",
       y = "",
       title = "",
       subtitle = "",
       caption = "Q)  Which tests do you currently use for your soil N testing?")+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(size = 8), legend.position = "none") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L)) 



```

#### **Question 15 P**
grower
Which tests do you use for P tests?

* Phosphorus 1 - Type of test
* Phosphorus 1 - Frequency (times per season)
* Phosphorus 1 - How many representative samples per paddock
* Phosphorus 2 - Type of test
* Phosphorus 2 - Frequency (times per season)
* Phosphorus 2 - How many representative samples per paddock
* Phosphorus 3 - Type of test
* Phosphorus 3 - Frequency (times per season)
* Phosphorus 3 - How many representative samples per paddock
* Phosphorus 4 - Type of test
* Phosphorus 4 - Frequency (times per season)
* Phosphorus 4 - How many representative samples per paddock
* Phosphorus 5 - Type of test
* Phosphorus 5 - Frequency (times per season)
* Phosphorus 5 - How many representative samples per paddock
* How frequently are your clients paddocks tested i.e. every 3 years, every 5 years ... other?


```{r soil test function - 5 tests, warning=TRUE, include=FALSE}

#Define a function that can be used for many similar questions...

soil_test_use5_all <- function(data_df, test1, numb_sample_test1, 
                        test2, numb_sample_test2,
                        test3, numb_sample_test3,
                        test4, numb_sample_test4,
                        test5, numb_sample_test5,
                        name, soil_test) {
  #test1
  subset_test1 <-
    select(data_df, !! test1, !! numb_sample_test1, Resp_Group, `Respondent ID`)
  
  colnames(subset_test1)[1] <- "test"
  colnames(subset_test1)[2] <- "numb_of_test"
  
  test1 <- subset_test1 %>%
    mutate(test  =
             case_when(test == soil_test ~ soil_test))
  
  #test2
  subset_test2 <-
    select(data_df, !! test2, !! numb_sample_test2, Resp_Group, `Respondent ID`)
  
  colnames(subset_test2)[1] <- "test"
  colnames(subset_test2)[2] <- "numb_of_test"
  
  test2 <- subset_test2 %>%
    mutate(test  =
             case_when(test == soil_test ~ soil_test))
  
  #test3
  subset_test3 <-
    select(data_df, !! test3, !! numb_sample_test3, Resp_Group, `Respondent ID`)
  
  colnames(subset_test3)[1] <- "test"
  colnames(subset_test3)[2] <- "numb_of_test"
  
  test3 <- subset_test3 %>%
    mutate(test  =
             case_when(test == soil_test ~ soil_test))
  
  
 #test4
  subset_test4 <-
    select(data_df, !! test4, !! numb_sample_test4, Resp_Group, `Respondent ID`)
  
  colnames(subset_test4)[1] <- "test"
  colnames(subset_test4)[2] <- "numb_of_test"
  
  test4 <- subset_test4 %>%
    mutate(test  =
             case_when(test == soil_test ~ soil_test))
  
   #test5
   subset_test5 <-
     select(data_df, !! test5, !! numb_sample_test5, Resp_Group, `Respondent ID`)
   
   colnames(subset_test5)[1] <- "test"
   colnames(subset_test5)[2] <- "numb_of_test"
   
  test5 <- subset_test5 %>%
    mutate(test  =
             case_when(test == soil_test ~ soil_test))
   
  # merge all the test togther
  test_all_clm <-bind_rows(test1, test2, test3, test4, 
                            test5
                           )
  
  #return(test_all_clm)
  return(assign(name,test_all_clm,envir = .GlobalEnv))
  
} 



```



```{r use soil test function on Q15 p, include=FALSE}

#inputs are the 6clms that contain the data and the test used 
#"PBI (Phosphorus Buffering Index)"
#"Olsen-Bray P"
#"Colwell P"
#"DGT"
#"Total P"
soil_test_use5_all(data, quo(Q_15.1.1), quo(Q_15.1.3), 
                     quo(Q_15.2.1), quo(Q_15.2.3),
                     quo(Q_15.3.1), quo(Q_15.3.3),
                     quo(Q_15.4.1), quo(Q_15.4.3),
                     quo(Q_15.5.1), quo(Q_15.5.3),
                    "test_PBI", "PBI (Phosphorus Buffering Index)")
soil_test_use5_all(data, quo(Q_15.1.1), quo(Q_15.1.3), 
                     quo(Q_15.2.1), quo(Q_15.2.3),
                     quo(Q_15.3.1), quo(Q_15.3.3),
                     quo(Q_15.4.1), quo(Q_15.4.3),
                     quo(Q_15.5.1), quo(Q_15.5.3),
                    "test_OB", "Olsen-Bray P")
soil_test_use5_all(data, quo(Q_15.1.1), quo(Q_15.1.3), 
                     quo(Q_15.2.1), quo(Q_15.2.3),
                     quo(Q_15.3.1), quo(Q_15.3.3),
                     quo(Q_15.4.1), quo(Q_15.4.3),
                     quo(Q_15.5.1), quo(Q_15.5.3),
                    "test_Col", "Colwell P")
soil_test_use5_all(data, quo(Q_15.1.1), quo(Q_15.1.3), 
                     quo(Q_15.2.1), quo(Q_15.2.3),
                     quo(Q_15.3.1), quo(Q_15.3.3),
                     quo(Q_15.4.1), quo(Q_15.4.3),
                     quo(Q_15.5.1), quo(Q_15.5.3),
                    "test_DGT", "DGT")
soil_test_use5_all(data, quo(Q_15.1.1), quo(Q_15.1.3), 
                     quo(Q_15.2.1), quo(Q_15.2.3),
                     quo(Q_15.3.1), quo(Q_15.3.3),
                     quo(Q_15.4.1), quo(Q_15.4.3),
                     quo(Q_15.5.1), quo(Q_15.5.3),
                    "test_TP", "Total P")

#count the number of people using this test and join 
PBI <- test_PBI %>%
  filter(!is.na(test)) %>%
  group_by( Resp_Group) %>%
  count(test) 
OB <- test_OB %>%
  filter(!is.na(test)) %>%
  group_by( Resp_Group) %>%
  count(test)
Col <- test_Col %>%
  filter(!is.na(test)) %>%
  group_by( Resp_Group) %>%
  count(test)
DGT <- test_DGT %>%
  filter(!is.na(test)) %>%
  group_by( Resp_Group) %>%
  count(test)
TP <- test_TP %>%
  filter(!is.na(test)) %>%
  group_by( Resp_Group) %>%
  count(test)


P_test_counts <- rbind(PBI, OB, Col, DGT, TP)
#Add in how many people in each group to cal the %
P_test_counts <- P_test_counts %>% 
  mutate(Resp_numb = case_when(
    Resp_Group == "Agronomist" ~ 71,
    Resp_Group == "Grower"  ~ 99
  ),
percent = n/Resp_numb
    )



### number of people sampling at certain density number of samples per paddock

PBI_numb <- test_PBI %>%
  filter(!is.na(numb_of_test)) %>%
  group_by( Resp_Group) %>%
  count(numb_of_test) 
OB_numb <- test_OB %>%
   filter(!is.na(numb_of_test)) %>%
  group_by( Resp_Group) %>%
  count(numb_of_test)
Col_numb <- test_Col %>%
   filter(!is.na(numb_of_test)) %>%
  group_by( Resp_Group) %>%
  count(numb_of_test)
DGT_numb <- test_DGT %>%
   filter(!is.na(numb_of_test)) %>%
  group_by( Resp_Group) %>%
  count(numb_of_test)
TP_numb <- test_TP %>%
   filter(!is.na(numb_of_test)) %>%
  group_by( Resp_Group) %>%
  count(numb_of_test)

P_test_numb_counts <- rbind(PBI_numb, OB_numb, Col_numb, DGT_numb, TP_numb)

P_test_numb_counts <- P_test_numb_counts %>% 
  mutate(Resp_numb = case_when(
   Resp_Group == "Agronomist" ~ 71,
    Resp_Group == "Grower"  ~ 99
  ),
percent = n/Resp_numb
    )

P_test_counts
P_test_numb_counts

```





```{r graph _Q15 P}

#table
select(P_test_counts,Resp_Group, test , n,   percent) %>%
datatable( colnames = c("Respondent" = "Resp_Group",
                        "count" = "n",
                         "test" = "test" ,
                         "percent" = "percent" ),
           options = list(pageLength = 35,  dom = 't'))%>%
     formatPercentage(c("percent"
                        ))


#N_test_counts

#percent of people in survey using certain test
ggplot(P_test_counts, aes (x = test, y = percent, fill = Resp_Group))+
  geom_col()+
  scale_fill_manual(values=c("grey70", "grey40"))+
  facet_wrap(.~ Resp_Group )+
  theme_classic()+
  labs(x= "",
       y = "",
       title = "P test used",
       subtitle = "",
       caption = "Q)  Which tests do you currently use for your soil P testing?")+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(size = 8), legend.position = "none") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L)) 


# df needs ording for display
P_test_numb_counts$numb_of_test <- factor(P_test_numb_counts$numb_of_test,levels = c("0-5",  "5-10", "10-15", 
                                                                                             "15-20", "20-25",  "25-30", 
                                                                                             "greater than 30"))

#percent of people in survey using sampling at certain density - number of samples per paddock
ggplot(P_test_numb_counts, aes (x = numb_of_test, y = percent, fill = Resp_Group))+
  geom_col()+
  scale_fill_manual(values=c("grey70", "grey40"))+
  facet_wrap(.~ Resp_Group )+
  theme_classic()+
  labs(x= "Number of samples per paddock",
       y = "",
       title = "",
       subtitle = "",
       caption = "Q)  Which tests do you currently use for your soil P testing?")+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(size = 8), legend.position = "none") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L)) 

```




#### **Question 16 Potassium**
What tests do you use for Potassium testing ...

* Potassium 1 - Type of test
* Potassium 1 - Frequency (times per season)
* Potassium 1 - How many representative samples per paddock
* Potassium 2 - Type of test
* Potassium 2 - Frequency (times per season)
* Potassium 2 - How many representative samples per paddock
* Potassium 3 - Type of test
* Potassium 3 - Frequency (times per season)
* Potassium 3 - How many representative samples per paddock
* How frequently are your clients paddocks tested i.e. every 3 years, every 5 years ... other?9

```{r soil test function - 2 tests, include=FALSE}

#Define a function that can be used for many similar questions...

soil_test_use2_all <- function(data_df, test1, numb_sample_test1, 
                        test2, numb_sample_test2,
                        #test3, numb_sample_test3,
                        #test4, numb_sample_test4,
                        #test5, numb_sample_test5,
                        name, soil_test) {
 #test1
  subset_test1 <-
    select(data_df, !! test1, !! numb_sample_test1, Resp_Group, `Respondent ID`)
  
  colnames(subset_test1)[1] <- "test"
  colnames(subset_test1)[2] <- "numb_of_test"
  
  test1 <- subset_test1 %>%
    mutate(test  =
             case_when(test == soil_test ~ soil_test))
  
  #test2
  subset_test2 <-
    select(data_df, !! test2, !! numb_sample_test2, Resp_Group, `Respondent ID`)
  
  colnames(subset_test2)[1] <- "test"
  colnames(subset_test2)[2] <- "numb_of_test"
  
  test2 <- subset_test2 %>%
    mutate(test  =
             case_when(test == soil_test ~ soil_test))
  
 
  # merge all the test togther
  test_all_clm <-bind_rows(test1, test2, 
                           #test3, test4, 
                           # test5
                           )
  
  #return(test_all_clm)
  return(assign(name,test_all_clm,envir = .GlobalEnv))
  
} 
```


```{r use soil test function on Q16 k, include=FALSE}

#"Colwell K"  "Exchangable Cations (Ca, Mg, K, Na)"

soil_test_use2_all(data, quo(Q_16.1.1), quo(Q_16.1.3), 
                     quo(Q_16.2.1), quo(Q_16.2.3),
                     "test_Col_K", "Colwell K")
soil_test_use2_all(data, quo(Q_16.1.1), quo(Q_16.1.3), 
                     quo(Q_16.2.1), quo(Q_16.2.3),
                     "test_EXC", "Exchangeable Cations (Ca, Mg, K, Na)")


#count the number of people using this test and join 
Col_K <- test_Col_K %>%
  filter(!is.na(test)) %>% 
  group_by( Resp_Group) %>%
  count(test) 
EXC <- test_EXC %>%
  filter(!is.na(test)) %>% 
  group_by( Resp_Group) %>%
  count(test)


K_test_counts <- rbind(Col_K, EXC)
#Add in how many people in each group to cal the %
K_test_counts <- K_test_counts %>% 
  mutate(Resp_numb = case_when(
   Resp_Group == "Agronomist" ~ 71,
    Resp_Group == "Grower"  ~ 99
  ),
percent = n/Resp_numb
    )



### number of people sampling at certain density number of samples per paddock

Col_K_numb <- test_Col_K %>%
  filter(!is.na(numb_of_test)) %>% 
  group_by( Resp_Group) %>%
  count(numb_of_test) 
EXC_numb <- test_EXC %>%
  filter(!is.na(numb_of_test)) %>% 
  group_by( Resp_Group) %>%
  count(numb_of_test)

K_test_numb_counts <- rbind(Col_K_numb, EXC_numb)

K_test_numb_counts <- K_test_numb_counts %>% 
  mutate(Resp_numb = case_when(
    Resp_Group == "Agronomist" ~ 71,
    Resp_Group == "Grower"  ~ 99
  ),
percent = n/Resp_numb
    )
K_test_counts
K_test_numb_counts

```

```{r graph _Q16 K}
# table
select(K_test_counts,Resp_Group, test , n,   percent) %>%
datatable( colnames = c("Respondent" = "Resp_Group",
                        "count" = "n",
                         "test" = "test" ,
                         "percent" = "percent" ),
           options = list(pageLength = 35,  dom = 't'))%>%
     formatPercentage(c("percent"
                        ))

#N_test_counts

#percent of people in survey using certain test
ggplot(K_test_counts, aes (x = test, y = percent, fill = Resp_Group))+
  geom_col()+
  scale_fill_manual(values=c("grey70", "grey40"))+
  facet_wrap(.~ Resp_Group )+
  theme_classic()+
  labs(x= "",
       y = "",
       title = "K test used",
       subtitle = "",
       caption = "Q)  Which tests do you currently use for your soil K testing?")+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(size = 8), legend.position = "none") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L)) 


# df needs ording for display
K_test_numb_counts$numb_of_test <- factor(K_test_numb_counts$numb_of_test,levels = c("0-5",  "5-10", "10-15", 
                                                                                             "15-20", "20-25",  "25-30", 
                                                                                             "greater than 30"))

#percent of people in survey using sampling at certain density - number of samples per paddock
ggplot(K_test_numb_counts, aes (x = numb_of_test, y = percent, fill = Resp_Group))+
  geom_col()+
  scale_fill_manual(values=c("grey70", "grey40"))+
  facet_wrap(.~ Resp_Group )+
  theme_classic()+
  labs(x= "Number of samples per paddock",
       y = "",
       title = "",
       subtitle = "",
       caption = "Q)  Which tests do you currently use for your soil K testing?")+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(size = 8), legend.position = "none") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L)) 

```






#### **Question 17 micronutrients**
And, which tests do you use for micronutrients?

* 1 - Type of test
* 1 - Frequency (times per season)
* 1 - How many cores per paddock
* 2 - Type of test
* 2 - Frequency (times per season)
* 2 - How many cores per paddock
* 3 - Type of test
* 3 - Frequency (times per season)
* 3 - How many cores per paddock
* 4 - Type of test
* 4 - Frequency (times per season)
* 4 - How many cores per paddock
* 5 - Type of test
* 5 - Frequency (times per season)
* 5 - How many cores per paddock
* 6 - Type of test
* 6 - Frequency (times per season)
* 6 - How many cores per paddock
* 7 - Type of test
* 7 - Frequency (times per season)
* 7 - How many cores per paddock
* 8 - Type of test
* 8 - Frequency (times per season)
* 8 - How many cores per paddock
* How frequently are your clients paddocks tested i.e. every 3 years, every 5 years ... other?10


```{r soil test function - 8 tests, include=FALSE}

#Define a function that can be used for many similar questions...

####slight modification to accomidate missing data!
soil_test_use8_All <- function(data_df, 
                        test1, numb_sample_test1, 
                        test2, numb_sample_test2,
                        test3, numb_sample_test3,
                        test4, numb_sample_test4,
                        test5, numb_sample_test5,
                        test6, numb_sample_test6,
                        test7, numb_sample_test7,
                        test8, numb_sample_test8,
                        name, soil_test) {
  #test1
  subset_test1 <-
    select(data_df, !! test1, !! numb_sample_test1, Resp_Group, `Respondent ID`)
  
  colnames(subset_test1)[1] <- "test"
  colnames(subset_test1)[2] <- "numb_of_test"
  
  test1 <- subset_test1 %>%
    mutate(test  =
             case_when(test == soil_test ~ soil_test))
  
  
  #test2
  subset_test2 <-
    select(data_df, !! test2, !! numb_sample_test2, Resp_Group, `Respondent ID`)
  
  colnames(subset_test2)[1] <- "test"
  colnames(subset_test2)[2] <- "numb_of_test"
  
 test2 <- subset_test2 %>%
    mutate(test  =
             case_when(test == soil_test ~ soil_test))
  
  #test3
  subset_test3 <-
    select(data_df, !! test3, !! numb_sample_test3, Resp_Group, `Respondent ID`)
  
  colnames(subset_test3)[1] <- "test"
  colnames(subset_test3)[2] <- "numb_of_test"
  
  test3 <- subset_test3 %>%
    mutate(test  =
             case_when(test == soil_test ~ soil_test))
  
  
 #test4
  subset_test4 <-
    select(data_df, !! test4, !! numb_sample_test4, Resp_Group, `Respondent ID`)
  
  colnames(subset_test4)[1] <- "test"
  colnames(subset_test4)[2] <- "numb_of_test"
  
  test4 <- subset_test4 %>%
    mutate(test  =
             case_when(test == soil_test ~ soil_test))
  
   #test5
   subset_test5 <-
     select(data_df, !! test5, !! numb_sample_test5, Resp_Group, `Respondent ID`)
   
   colnames(subset_test5)[1] <- "test"
   colnames(subset_test5)[2] <- "numb_of_test"
   
  test5 <- subset_test5 %>%
    mutate(test  =
             case_when(test == soil_test ~ soil_test))
  
   #test6
   subset_test6 <-
     select(data_df, !! test6, !! numb_sample_test6, Resp_Group, `Respondent ID`)
   
   colnames(subset_test6)[1] <- "test"
   colnames(subset_test6)[2] <- "numb_of_test"
   
  test6 <- subset_test6 %>%
    mutate(test  =
             case_when(test == soil_test ~ soil_test))
   
   #test7
   subset_test7 <-
     select(data_df, !! test7, !! numb_sample_test7, Resp_Group, `Respondent ID`)
   
   colnames(subset_test7)[1] <- "test"
   colnames(subset_test7)[2] <- "numb_of_test"
   
  test7 <- subset_test7 %>%
    mutate(test  =
             case_when(test == soil_test ~ soil_test))
  
   #test8
   subset_test8 <-
     select(data_df, !! test8, !! numb_sample_test8, Resp_Group, `Respondent ID`)

   colnames(subset_test8)[1] <- "test"
   colnames(subset_test8)[2] <- "numb_of_test"

  test8 <- subset_test8 %>%
    mutate(test  =
             case_when(test == soil_test ~ soil_test))
   
  # merge all the test togther
  test_all_clm <- bind_rows(test1,
                            test2,
                            test3,
                            test4,
                            test5,
                            test6,
                            test7,
                            test8
                            )
  
  #return(test_all_clm)
  return(assign(name,test_all_clm,envir = .GlobalEnv))
  
} 



```

```{r use soil test function on Q17 p, include=FALSE}
#first thing is to recode sulfur and trace elements
 data_chunck <- select(data, Q_17.1.1: Q_17.9, Resp_Group, `Respondent ID`)

data_chunck[] <- lapply(data_chunck, gsub, pattern = "Trace elements (DTPA) Cu, Zn, Mg, Fe", 
                 replacement = "Trace elements", fixed = TRUE)
data_chunck[] <- lapply(data_chunck, gsub, pattern = "Trace elements (EDTA) Cu, Zn, Mg, Fe", 
                 replacement = "Trace elements", fixed = TRUE)


data_chunck[] <- lapply(data_chunck, gsub, pattern = "Sulfur (KCl40)", 
                 replacement = "Sulfur", fixed = TRUE)	
data_chunck[] <- lapply(data_chunck, gsub, pattern = "Sulfur (MCP)", 
                 replacement = "Sulfur", fixed = TRUE)	



# Soil test Aluminium (CaCl2) not in test1 and test8
soil_test_use8_All(data_chunck, 
                     quo(Q_17.1.1), quo(Q_17.1.3), 
                     quo(Q_17.2.1), quo(Q_17.2.3),
                     quo(Q_17.3.1), quo(Q_17.3.3),
                     quo(Q_17.4.1), quo(Q_17.4.3),
                     quo(Q_17.5.1), quo(Q_17.5.3),
                     quo(Q_17.6.1), quo(Q_17.6.3),
                     quo(Q_17.7.1), quo(Q_17.7.3),
                     quo(Q_17.8.1), quo(Q_17.8.3),
                    "Al", "Aluminium (CaCl2)")

# Soil test Boron not in test7 
soil_test_use8_All(data_chunck, 
                     quo(Q_17.1.1), quo(Q_17.1.3), 
                     quo(Q_17.2.1), quo(Q_17.2.3),
                     quo(Q_17.3.1), quo(Q_17.3.3),
                     quo(Q_17.4.1), quo(Q_17.4.3),
                     quo(Q_17.5.1), quo(Q_17.5.3),
                     quo(Q_17.6.1), quo(Q_17.6.3),
                     quo(Q_17.7.1), quo(Q_17.7.3),
                     quo(Q_17.8.1), quo(Q_17.8.3),
                    "Born", "Boron")

# Soil test  Calcium carbonate %
soil_test_use8_All(data_chunck, 
                     quo(Q_17.1.1), quo(Q_17.1.3), 
                     quo(Q_17.2.1), quo(Q_17.2.3),
                     quo(Q_17.3.1), quo(Q_17.3.3),
                     quo(Q_17.4.1), quo(Q_17.4.3),
                     quo(Q_17.5.1), quo(Q_17.5.3),
                     quo(Q_17.6.1), quo(Q_17.6.3),
                     quo(Q_17.7.1), quo(Q_17.7.3),
                     quo(Q_17.8.1), quo(Q_17.8.3),
                    "CalCarb", "Calcium carbonate %")

# Soil test  Chloride
soil_test_use8_All(data_chunck, 
                     quo(Q_17.1.1), quo(Q_17.1.3), 
                     quo(Q_17.2.1), quo(Q_17.2.3),
                     quo(Q_17.3.1), quo(Q_17.3.3),
                     quo(Q_17.4.1), quo(Q_17.4.3),
                     quo(Q_17.5.1), quo(Q_17.5.3),
                     quo(Q_17.6.1), quo(Q_17.6.3),
                     quo(Q_17.7.1), quo(Q_17.7.3),
                     quo(Q_17.8.1), quo(Q_17.8.3),
                    "Chloride", "Chloride")

# Soil test  Exchangable cations - Ca, Mg, Na, K -USE CalCarb has same input forclms
soil_test_use8_All(data_chunck, 
                     quo(Q_17.1.1), quo(Q_17.1.3), 
                     quo(Q_17.2.1), quo(Q_17.2.3),
                     quo(Q_17.3.1), quo(Q_17.3.3),
                     quo(Q_17.4.1), quo(Q_17.4.3),
                     quo(Q_17.5.1), quo(Q_17.5.3),
                     quo(Q_17.6.1), quo(Q_17.6.3),
                     quo(Q_17.7.1), quo(Q_17.7.3),
                     quo(Q_17.8.1), quo(Q_17.8.3),
                    "Excat", "Exchangeable cations - Ca, Mg, Na, K")

# Soil test  pH
soil_test_use8_All(data_chunck, 
                     quo(Q_17.1.1), quo(Q_17.1.3), 
                     quo(Q_17.2.1), quo(Q_17.2.3),
                     quo(Q_17.3.1), quo(Q_17.3.3),
                     quo(Q_17.4.1), quo(Q_17.4.3),
                     quo(Q_17.5.1), quo(Q_17.5.3),
                     quo(Q_17.6.1), quo(Q_17.6.3),
                     quo(Q_17.7.1), quo(Q_17.7.3),
                     quo(Q_17.8.1), quo(Q_17.8.3),
                    "pH", "pH")

#Sulfur USE CalCarb has same input forclms
soil_test_use8_All(data_chunck, 
                     quo(Q_17.1.1), quo(Q_17.1.3), 
                     quo(Q_17.2.1), quo(Q_17.2.3),
                     quo(Q_17.3.1), quo(Q_17.3.3),
                     quo(Q_17.4.1), quo(Q_17.4.3),
                     quo(Q_17.5.1), quo(Q_17.5.3),
                     quo(Q_17.6.1), quo(Q_17.6.3),
                     quo(Q_17.7.1), quo(Q_17.7.3),
                     quo(Q_17.8.1), quo(Q_17.8.3),
                    "Sulfur", "Sulfur")

#Texture
soil_test_use8_All(data_chunck, 
                     quo(Q_17.1.1), quo(Q_17.1.3), 
                     quo(Q_17.2.1), quo(Q_17.2.3),
                     quo(Q_17.3.1), quo(Q_17.3.3),
                     quo(Q_17.4.1), quo(Q_17.4.3),
                     quo(Q_17.5.1), quo(Q_17.5.3),
                      quo(Q_17.6.1), quo(Q_17.6.3),
                      quo(Q_17.7.1), quo(Q_17.7.3),
                      quo(Q_17.8.1), quo(Q_17.8.3),
                    "Texture", "Texture")
#Trace elements
soil_test_use8_All(data_chunck, 
                     quo(Q_17.1.1), quo(Q_17.1.3), 
                     quo(Q_17.2.1), quo(Q_17.2.3),
                     quo(Q_17.3.1), quo(Q_17.3.3),
                     quo(Q_17.4.1), quo(Q_17.4.3),
                     quo(Q_17.5.1), quo(Q_17.5.3),
                     quo(Q_17.6.1), quo(Q_17.6.3),
                     quo(Q_17.7.1), quo(Q_17.7.3),
                      quo(Q_17.8.1), quo(Q_17.8.3),
                    "Trace", "Trace elements")

#count the number of people using this test and join 
Trace1 <- Trace %>%
  filter(!is.na(test)) %>% 
  group_by( Resp_Group) %>%
  count(test) 
Texture1 <- Texture %>%
   filter(!is.na(test)) %>% 
  group_by( Resp_Group) %>%
  count(test)
Sulfur1 <- Sulfur %>%
   filter(!is.na(test)) %>% 
  group_by( Resp_Group) %>%
  count(test)
pH1 <- pH %>%
   filter(!is.na(test)) %>% 
  group_by( Resp_Group) %>%
  count(test)
Excat1 <- Excat %>%
   filter(!is.na(test)) %>% 
  group_by( Resp_Group) %>%
  count(test)
Chloride1 <- Chloride %>%
   filter(!is.na(test)) %>% 
  group_by( Resp_Group) %>%
  count(test)
CalCarb1 <- CalCarb %>%
   filter(!is.na(test)) %>% 
  group_by( Resp_Group) %>%
  count(test)
Born1 <- Born %>%
   filter(!is.na(test)) %>% 
  group_by( Resp_Group) %>%
  count(test)
Al1 <- Al %>%
   filter(!is.na(test)) %>% 
  group_by( Resp_Group) %>%
  count(test)


mirco_test_counts <- rbind(Trace1,
                           Texture1,
                           Sulfur1,
                           pH1,
                           Excat1,
                           Chloride1,
                           CalCarb1,
                           Born1,
                           Al1)

#Add in how many people in each group to cal the %
mirco_test_counts <- mirco_test_counts %>% 
  mutate(Resp_numb = case_when(
    Resp_Group == "Agronomist" ~ 71,
    Resp_Group == "Grower"  ~ 99
  ),
percent = n/Resp_numb
    )

Trace2 <- Trace %>%
   filter(!is.na(numb_of_test)) %>% 
  group_by( Resp_Group) %>%
  count(numb_of_test) 
Texture2 <- Texture %>%
  filter(!is.na(numb_of_test)) %>% 
  group_by( Resp_Group) %>%
  count(numb_of_test)
Sulfur2 <- Sulfur %>%
  filter(!is.na(numb_of_test)) %>% 
  group_by( Resp_Group) %>%
  count(numb_of_test)
pH2 <- pH %>%
  filter(!is.na(numb_of_test)) %>% 
  group_by( Resp_Group) %>%
  count(test)
Excat2 <- Excat %>%
  filter(!is.na(numb_of_test)) %>% 
  group_by( Resp_Group) %>%
  count(numb_of_test)
Chloride2 <- Chloride %>%
  filter(!is.na(numb_of_test)) %>% 
  group_by( Resp_Group) %>%
  count(numb_of_test)
CalCarb2 <- CalCarb %>%
  filter(!is.na(numb_of_test)) %>% 
  group_by( Resp_Group) %>%
  count(numb_of_test)
Born2 <- Born %>%
  filter(!is.na(numb_of_test)) %>% 
  group_by( Resp_Group) %>%
  count(numb_of_test)
Al2 <- Al %>%
  filter(!is.na(numb_of_test)) %>% 
  group_by( Resp_Group) %>%
  count(numb_of_test)

mirco_test_numb_counts <- rbind(Trace2,
                           Texture2,
                           Sulfur2,
                           pH2,
                           Excat2,
                           Chloride2,
                           CalCarb2,
                           Born2,
                           Al2)

mirco_test_numb_counts <- mirco_test_numb_counts %>% 
  mutate(Resp_numb = case_when(
    Resp_Group == "Agronomist" ~ 71,
    Resp_Group == "Grower"  ~ 99
  ),
  
percent = n/Resp_numb
    )




mirco_test_counts
mirco_test_numb_counts
```


```{r graph _Q1 mirco}


mirco_test_counts
#mirco_test_numb_counts

#percent of people in survey using certain test
ggplot(mirco_test_counts, aes (x = test, y = percent, fill = Resp_Group))+
  geom_col()+
  scale_fill_manual(values=c("grey70", "grey40"))+
  facet_wrap(.~ Resp_Group )+
  theme_classic()+
  labs(x= "",
       y = "",
       title = "micronutrients test used",
       subtitle = "",
       caption = "Q)  Which tests do you currently use for your soil micronutrients testing?")+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(size = 8), legend.position = "none") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L)) 


# df needs ording for display
mirco_test_numb_counts$numb_of_test <-
  factor(
    mirco_test_numb_counts$numb_of_test,
    levels = c(
      "0-5",
      "5-10",
      "10-15",
      "15-20",
      "20-25",
      "25-30",
      "greater than 30"
    )
  )

#percent of people in survey using sampling at certain density - number of samples per paddock
ggplot(mirco_test_numb_counts, aes (x = numb_of_test, y = percent, fill = Resp_Group))+
  geom_col()+
  scale_fill_manual(values=c("grey70", "grey40"))+
  facet_wrap(.~ Resp_Group )+
  theme_classic()+
  labs(x= "Number of samples per paddock",
       y = "",
       title = "",
       subtitle = "",
       caption = "Q)  Which tests do you currently use for your soil micronutrients testing?")+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(size = 8), legend.position = "none") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L)) 

```





#### **Question 18**
What are the top 3 reasons for soil testing on your clients farms ...

* 1
* 2
* 3

#### **Question 19**
Please indicate why you don't do more SOIL Nitrogen testing:

* The cost of soil sampling
* The time required for soil sampling
* The cost of soil testing lab analysis
* The difficulty in being able to represent the variability in a paddock
* The level of accuracy of soil testing lab analysis
* The ability to translate soil test results into a profitable fertiliser decision for my paddock
* Not being able to get soil test results at the right time for decision making
* General comments:

```{r function for to cal the % of respnondents, echo=FALSE}
##function for to cal the % of respnondents
summary_stats_all_resp <- function(df, group_by, clm_in_df){  
  df <- filter( df, !! clm_in_df != "NA") %>% 
    group_by(!! group_by) %>% 
    count(!! clm_in_df) %>% 
    mutate(
      Resp_numb = case_when(Resp_Group == "Agronomist" ~ 71,
                            Resp_Group == "Grower" ~ 99),
      percent = n / Resp_numb)
  
  colnames(df)[2] <- "reason"
  return(df)
}


```

```{r data prep Q19}
#use function

Ncost <- summary_stats_all_resp(data, quo(Resp_Group), quo(Q_19.1))
time_for_sampling <- summary_stats_all_resp(data, quo(Resp_Group), quo(Q_19.2))
cost_lab_analysis <- summary_stats_all_resp(data, quo(Resp_Group), quo(Q_19.3))
variability <- summary_stats_all_resp(data, quo(Resp_Group), quo(Q_19.4))
accurancy <- summary_stats_all_resp(data, quo(Resp_Group), quo(Q_19.5))
decsision <- summary_stats_all_resp(data, quo(Resp_Group), quo(Q_19.6))
timing <- summary_stats_all_resp(data, quo(Resp_Group), quo(Q_19.7))

#join the reasons together

reason_soil_N <- rbind(Ncost, 
              time_for_sampling,
              cost_lab_analysis,
              variability,
              accurancy,
              decsision,
              timing)


```

```{r graphs Q19}
reason_soil_N

#text is too long
reason_soil_N 

reason_soil_N <- mutate(
  reason_soil_N,
  names_display = case_when(
    reason == "The cost of soil sampling" ~ "cost",
    reason == "The time required for soil sampling" ~ "time",
    reason == "The cost of soil testing lab analysis" ~ "cost of lab analysis",
    reason == "The difficulty in being able to represent the variability in a paddock" ~ "variability",
    reason == "The level of accuracy of soil testing lab analysis" ~ "accuracy",
    reason == "The ability to translate soil test results into a profitable fertiliser decision for my paddock" ~ "translate profitable decision",
    reason == "Not being able to get soil test results at the right time for decision making" ~ "get results at right time"
  )
)

ggplot(reason_soil_N, aes (x =  reorder(names_display, -percent), y = percent, fill = Resp_Group))+
  geom_col()+
  scale_fill_manual(values=c("grey70", "grey40"))+
  facet_wrap(.~ Resp_Group )+
  theme_classic()+
  labs(x= "",
       y = "",
       title = "",
       subtitle = "",
       caption = "Q)  Please indicate why you don't do more soil nitrogen testing?")+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(size = 8), legend.position = "none") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L)) 

```










#### **Question 20**
Please indicate why you don't do more SOIL Phosphorous testing

* The cost of soil sampling
* The time required for soil sampling
* The cost of soil testing lab analysis
* The difficulty in being able to represent the variability in a paddock
* The level of accuracy of soil testing lab analysis
* The ability to translate soil test results into a profitable fertiliser decision for my paddock
* Not being able to get soil test results at the right time for decision making
* General comments:



```{r data prep Q20}
#use function

Q20_why_not_moreP_cost <- summary_stats_all_resp(data, quo(Resp_Group), quo(Q_20.1))
Q20_why_not_moreP_time <- summary_stats_all_resp(data, quo(Resp_Group), quo(Q_20.2))
Q20_why_not_moreP_lab_cost <- summary_stats_all_resp(data, quo(Resp_Group), quo(Q_20.3))
Q20_why_not_moreP_variability <- summary_stats_all_resp(data, quo(Resp_Group), quo(Q_20.4))
Q20_why_not_moreP_lab_accuracy <- summary_stats_all_resp(data, quo(Resp_Group), quo(Q_20.5))
Q20_why_not_moreP_test_profit_decis <- summary_stats_all_resp(data, quo(Resp_Group), quo(Q_20.6))
Q20_why_not_moreP_too_slow <- summary_stats_all_resp(data, quo(Resp_Group), quo(Q_20.7))



#join the reasons together

reason_soil_P<- rbind(
  Q20_why_not_moreP_cost,
  Q20_why_not_moreP_time,
  Q20_why_not_moreP_lab_cost,
  Q20_why_not_moreP_variability,
  Q20_why_not_moreP_lab_accuracy,
  Q20_why_not_moreP_test_profit_decis,
  Q20_why_not_moreP_too_slow
)


```


```{r graphs Q20}
reason_soil_P

#text is too long
reason_soil_P 

reason_soil_P <- mutate(
  reason_soil_P,
  names_display = case_when(
    reason == "The cost of soil sampling" ~ "cost",
    reason == "The time required for soil sampling" ~ "time",
    reason == "The cost of soil testing lab analysis" ~ "cost of lab analysis",
    reason == "The difficulty in being able to represent the variability in a paddock" ~ "variability",
    reason == "The level of accuracy of soil testing lab analysis" ~ "accuracy",
    reason == "The ability to translate soil test results into a profitable fertiliser decision for my paddock" ~ "translate profitable decision",
    reason == "Not being able to get soil test results at the right time for decision making" ~ "get results at right time"
  )
)

ggplot(reason_soil_P, aes (x =  reorder(names_display, -percent), y = percent, fill = Resp_Group))+
  geom_col()+
  scale_fill_manual(values=c("grey70", "grey40"))+
  facet_wrap(.~ Resp_Group )+
  theme_classic()+
  labs(x= "",
       y = "",
       title = "",
       subtitle = "",
       caption = "Q)  Please indicate why you don't do more soil P testing?")+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(size = 8), legend.position = "none") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L)) 

```


#### **Question 21** 

Please indicate if you agree/disagree with the following statements in relation to SOIL testing.


	The use of soil testing on my farm increases my profitability (Grower only Q)	Feel free to comment on this response

* 21.1 My clients businesses would be more profitable if they did more soil testing than they do now 
* 21.2 Uncertainty about how the season will turn out makes it hard to get value from soil testing results 
* 21.3 My clients recommend the use of regular soil testing to other local farmers
* 21.4 The use of soil testing on my farm increases my profitability (Grower only Q)
* 21.5 Feel free to comment on this response


```{r q21 data prep, include=FALSE}

data$Q_21.1
#group the Q21 data together
subsetQ21 <- select(data, Q_21.1, Q_21.2, Q_21.3, Q_21.4, Q_21.5, Resp_Group) 
#how many people ans the questions


grower_na <- subsetQ21 %>% 
  filter(Resp_Group == "Grower" ) %>% 
  select_if(function(Q_21.1) any(is.na(Q_21.1))) %>% 
  summarise_each(funs(sum(is.na(.)))) -> extra_NA

agronomist_na <- subsetQ21 %>% 
  filter(Resp_Group == "Agronomist" ) %>% 
  select_if(function(Q_21.1) any(is.na(Q_21.1))) %>% 
  summarise_each(funs(sum(is.na(.)))) -> extra_NA

Q21_ans_g <-as.vector(99 - grower_na[1,1], mode = 'numeric') 
Q21_ans_a <- 71 - as.vector(agronomist_na[1,1], mode = 'numeric') 
grower_na

##Q_21.1

subsetQ21.1_summary <- subsetQ21 %>%
  filter(!is.na(Q_21.1)) %>% 
  group_by( Resp_Group, Q_21.1) %>%
  count(Q_21.1) 

subsetQ21.1_summary <- subsetQ21.1_summary %>% 
  mutate(Resp_numb_for_question = case_when(
    Resp_Group == "Agronomist" ~ (71 - as.vector(agronomist_na[1,1], mode = 'numeric')),
    Resp_Group == "Grower"  ~  (99- as.vector(grower_na[1,1], mode = 'numeric')) ),
    percent_of_numb_resp = n/Resp_numb_for_question,
    question = "more profitable",
    scale = Q_21.1
  )

subsetQ21.1_summary

##Q_21.2

subsetQ21.2_summary <- subsetQ21 %>%
  filter(!is.na(Q_21.2)) %>% 
  group_by( Resp_Group, Q_21.2) %>%
  count(Q_21.2) 

subsetQ21.2_summary <- subsetQ21.2_summary %>% 
  mutate(Resp_numb_for_question = case_when(
    Resp_Group == "Agronomist" ~ (71 - as.vector(agronomist_na[1,2], mode = 'numeric')),
    Resp_Group == "Grower"  ~  (99- as.vector(grower_na[1,2], mode = 'numeric')) ),
    percent_of_numb_resp = n/Resp_numb_for_question,
    question = "Uncertainty",
    scale = Q_21.2
  )

subsetQ21.2_summary

##Q_21.3

subsetQ21.3_summary <- subsetQ21 %>%
  filter(!is.na(Q_21.3)) %>% 
  group_by( Resp_Group, Q_21.3) %>%
  count(Q_21.3) 

subsetQ21.3_summary <- subsetQ21.3_summary %>% 
  mutate(Resp_numb_for_question = case_when(
    Resp_Group == "Agronomist" ~ (71 - as.vector(agronomist_na[1,3], mode = 'numeric')),
    Resp_Group == "Grower"  ~  (99- as.vector(grower_na[1,3], mode = 'numeric')) ),
    percent_of_numb_resp = n/Resp_numb_for_question,
    question = "recommend",
    scale = Q_21.3
  )

subsetQ21.3_summary


##Q_21.4

subsetQ21.4_summary <- subsetQ21 %>%
  filter(!is.na(Q_21.4)) %>% 
  group_by( Resp_Group, Q_21.4) %>%
  count(Q_21.4) 

subsetQ21.4_summary <- subsetQ21.4_summary %>% 
  mutate(Resp_numb_for_question = case_when(
    Resp_Group == "Agronomist" ~ (71 - as.vector(agronomist_na[1,3], mode = 'numeric')),
    Resp_Group == "Grower"  ~  (99- as.vector(grower_na[1,3], mode = 'numeric')) ),
    percent_of_numb_resp = n/Resp_numb_for_question,
    question = "my profitability ",
    scale = Q_21.4
  ) 



subsetQ21_summary <- rbind(subsetQ21.1_summary,
                           subsetQ21.2_summary,
                           subsetQ21.3_summary,
                           subsetQ21.4_summary)

subsetQ21_summary <- select(subsetQ21_summary,
                            Resp_Group,
                            n,
                            Resp_numb_for_question,
                            percent_of_numb_resp,
                            question,scale)
subsetQ21_summary


```


```{r Q21 graph, echo=FALSE}
# df needs ording for display
subsetQ21_summary$scale <-
  factor(
    subsetQ21_summary$scale ,
    levels = c(
      "Strongly agree",
      "Agree",
      "Neutral",
      "Disagree",
      "Strongly disagree"
    )
  )

unique(subsetQ21_summary$scale)

ggplot(subsetQ21_summary, aes (x =  reorder(scale, -percent_of_numb_resp), y = percent_of_numb_resp, 
                               fill = Resp_Group))+
  geom_col()+
  scale_fill_manual(values=c("grey70", "grey40"))+
  facet_wrap(question~ Resp_Group )+
  theme_classic()+
  labs(x= "",
       y = "",
       title = "",
       subtitle = "",
       caption = "Q)  Please indicate why you don't do more soil P testing?")+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        plot.caption = element_text(size = 8), legend.position = "none") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L)) 

```



#### **Question 22** 
On average, how much would your clients spend each year on soil testing (including sampling)?

#### **Question 23** 
Compared to five years' ago, has the amount of soil testing you do / recommend changed?

#### **Question 24** 
In five years' time, how much soil sampling do you expect to be doing / recommending?

# PLANT TESTING 

#### **Question 25**
How do you currently use plant testing?

#### **Question 26**
Please list the main 3 reasons you use plant testing data?

#### **Question 27**
Please indicate why you don't do more PLANT testing

* The cost of sampling
* The time required for sampling
* The cost of lab analysis
* The difficulty in being able to represent the variability in a paddock29
* The level of accuracy of lab analysis
* The ability to translate test results into a profitable decision
* Not being able to get test results at the right time for decision making
* General comments


#### **Question 28** 
Agronomist
Please indicate if you agree/disagree with the following statements in relation to PLANT testing

* My clients businesses would be more profitable if they did more plant testing than they do now
* Uncertainty about how the season will turn out makes it hard to get value from plant testing results
* My clients recommend the use of regular plant testing to other local farmers
* Feel free to comment on this response

Grower
Please indicate if you agree/disagree with the following statements in relation to  PLANT testing
* My farm business would be more profitable if I did more plant testing than I do now
* Uncertainty about how the season will turn out makes it hard to get value from plant testing results
* I would recommend the use of regular plant testing to other local farmers


#### **Question 29**
Agronomist
On average, how much would your clients spend per year on plant testing (including sampling)?
Grower
On average, how much would you spend per year on  plant testing (including sampling)?

#### **Question 30** 
Agronomist
Compared to five years' ago, has the amount of plant testing you do / recommend changed?
Grower
Compared to five years' ago, has the amount of plant testing you do on your farm changed?


#### **Question 31**
Agronomist
In five years' time,how much plant sampling do you expect to be doing / recommending?
Grower
In five years' time, how much plant sampling do you expect to be doing?


#### **Question 32**
Agronomist
Grower
Is the use of soil testing on your farm increasing your profitability?


#### **Question 33**
Agronomist
Grower
Please indicate why you don't do SOIL Nitrogen testing

The cost of soil sampling 
The level of accuracy of soil testing lab analysis
The ability to translate soil test results into a profitable fertiliser decision for my paddock
Not being able to get soil test results at the right time for decision making 
The time required for soil sampling 
The cost of soil testing lab analysis 
The difficulty in being able to represent the variability in a paddock 
General comments:


#### **Question 34**
Agronomist
Grower
Please indicate why you don't do SOIL Phosphorous  testing

The cost of soil sampling 
The level of accuracy of soil testing lab analysis
The ability to translate soil test results into a profitable fertiliser decision for my paddock
Not being able to get soil test results at the right time for decision making 
The time required for soil sampling 
The cost of soil testing lab analysis 
The difficulty in being able to represent the variability in a paddock 
General comments:


#### **Question 35** 
Agronomist
Grower
Please indicate if you agree/disagree with the following statements in relation to SOIL testing
* My farm business would be more profitable if I did more soil testing than I do now
* Uncertainty about how the season will turn out makes it hard to get value from soil testing results


#### **Question 36** 
Agronomist
Grower
Please indicate why you don't do any PLANT testing

* The cost of plant sampling
* The time required for plant sampling
* The cost of plant analysis
* The difficulty in being able to represent the variability in a paddock55
* The level of accuracy of plant analysis
* The ability to translate plant test results into a profitable fertiliser decision for my paddock
* Not being able to get plant test results at the right time for decision making
* Comment



#### **Question 37**
Agronomist
Please indicate if you agree/disagree with the following statements in relation to PLANT testing

* My clients businesses would be more profitable if they did more plant testing than they do now
* Uncertainty about how the season will turn out makes it hard to get value from plant testing results
* Feel free to comment on this response

Grower
Please indicate if you agree/disagree with the following statements in relation to  PLANT testing
* My farm business would be more profitable if I did more plant testing than I do now
* Uncertainty about how the season will turn out makes it hard to get value from plant testing results




#### **Question 38** 
What are the barriers to you undertaking...?

* Soil testing? - Sampling cost
* Soil testing? - Analysis cost
* Soil testing? - Sampling time
* Soil testing? - Analysis time
* Soil testing? - Understanding / interpreting results
* Soil testing? - Sampling method
* Plant testing? - Sampling cost
* Plant testing? - Analysis cost
* Plant testing? - Sampling time
* Plant testing? - Analysis time
* Plant testing? - Understanding / interpreting results
* Plant testing? - Sampling method
* Other (please specify)



```{r Q33-38}


#### **Question 33-38**
# Note these responses should be from reposondants not undertaking any soil testing 
# (survey script from Q6 directs those not testing to go to page 8 (Q33?).
# However, responses have been entered by those that answered either yes or no to Q6-
#   "Q6: Do you do/recommend soil and/or plant testing?			


# Q33 Please indicate why you don't do SOIL Nitrogen testing
# 
# Reason
# The cost of soil sampling (2)
# The level of accuracy of soil testing lab analysis
# The ability to translate soil test results into a profitable fertiliser decision for my paddock (2)
# Not being able to get soil test results at the right time for decision making (1)
# The time required for soil sampling (1)
# The cost of soil testing lab analysis 
# The difficulty in being able to represent the variability in a paddock (1)
# General comments:
  


# * General comments: 
# Blanket N generally effective in our area   (1)                 
# Little farmer interest (1)
# time taken too much (1) 

#Q33 & 34 The  number of responses are very low and are shown in ()next to the reason, no Agronomists responded except one for 33.8
# Little farmer interest (1)


headers <- read_excel("Nutrient Management Survey_Agrononomist09092019.xlsx", 
                   sheet = "Data", col_names=FALSE, range = "A1:HL1")
data <- read_excel("Nutrient Management Survey_Agrononomist09092019.xlsx", 
                   sheet = "Data", col_names=FALSE, range = "A5:HL174")
names(data) <- headers

data

data$Q_33.1 
data$Q_33.2
data$Q_33.3
data$Q_33.4
data$Q_33.5
data$Q_33.6
data$Q_33.7
data$Q_33.8


subsetQ33 <- select(data, Q_33.1, Q_33.2, Q_33.3, Q_33.4, Q_33.5, Q_33.6, Q_33.7, Q_33.8, Resp_Group) 
#how many people na the questions
subsetQ33

grower_na <- subsetQ33 %>% 
  filter(Resp_Group == "Grower" ) %>% 
  select_if(function(Q_33.1) any(is.na(Q_33.1))) %>% 
  summarise_each(funs(sum(is.na(.)))) -> extra_NA

agronomist_na <- subsetQ33 %>% 
  filter(Resp_Group == "Agronomist" ) %>% 
  select_if(function(Q_33.1) any(is.na(Q_33.1))) %>% 
  summarise_each(funs(sum(is.na(.)))) -> extra_NA

Q33_ans_g <-as.vector(99 - grower_na[1,1], mode = 'numeric') 
Q33_ans_a <- 71 - as.vector(agronomist_na[1,1], mode = 'numeric') 
grower_na
agronomist_na


 ## Q 34
 # Agronomist
 # Grower
 # Please indicate why you don't do SOIL Phosphorous  testing

# The cost of soil sampling (1)
# The level of accuracy of soil testing lab analysis
# The ability to translate soil test results into a profitable fertiliser decision for my paddock (1)
# Not being able to get soil test results at the right time for decision making 
# The time required for soil sampling (1)
# The cost of soil testing lab analysis 
# The difficulty in being able to represent the variability in a paddock 
# General comments:
# The cost of soil sampling 

#  Q34 The  number of responses are  low, no Agronomists responded except one for 33.8
#  # Little farmer interest (1)
 
 data
 
 data$Q_34.1 
 data$Q_34.2
 data$Q_34.3
 data$Q_34.4
 data$Q_34.5
 data$Q_34.6
 data$Q_34.7
 data$Q_34.8
 
 
 subsetQ34 <- select(data, Q_34.1, Q_34.2, Q_34.3, Q_34.4, Q_34.5, Q_34.6, Q_34.7, Q_34.8, Resp_Group) 
 #how many people na the questions
 subsetQ34
 
 grower_na <- subsetQ34 %>% 
   filter(Resp_Group == "Grower" ) %>% 
   select_if(function(Q_34.1) any(is.na(Q_34.1))) %>% 
   summarise_each(funs(sum(is.na(.)))) -> extra_NA
 
 agronomist_na <- subsetQ34 %>% 
   filter(Resp_Group == "Agronomist" ) %>% 
   select_if(function(Q_34.1) any(is.na(Q_34.1))) %>% 
   summarise_each(funs(sum(is.na(.)))) -> extra_NA
 
 Q34_ans_g <-as.vector(99 - grower_na[1,1], mode = 'numeric') 
 Q34_ans_a <- 71 - as.vector(agronomist_na[1,1], mode = 'numeric') 
 grower_na
 agronomist_na
 
 
 # Q34_why_not_moreP_cost <- summary_stats_all_resp(data, quo(Resp_Group), quo(Q_34.1))
 # Q34_why_not_moreP_lab_accuracy <- summary_stats_all_resp(data, quo(Resp_Group), quo(Q_34.2))
 # Q34_why_not_moreP_test_profit_decision <- summary_stats_all_resp(data, quo(Resp_Group), quo(Q_34.3))
 # Q34_why_not_moreP_right_time <- summary_stats_all_resp(data, quo(Resp_Group), quo(Q_34.4))
 # Q34_why_not_moreP_time_required <- summary_stats_all_resp(data, quo(Resp_Group), quo(Q_34.5))
 # Q34_why_not_moreP_cost_analysis <- summary_stats_all_resp(data, quo(Resp_Group), quo(Q_34.6))
 # Q34_why_not_moreP_paddock_variability <- summary_stats_all_resp(data, quo(Resp_Group), quo(Q_34.7))
 #
 # 
 # 
 # #join the reasons together
 # 
 # reason_soil_P<- rbind(
 #   Q34_why_not_moreP_cost,
 #   Q34_why_not_moreP_lab_accuracy,
 #   Q34_why_not_moreP_test_profit_decision,
 #   Q34_why_not_moreP_right_time,
 #   Q34_why_not_moreP_time_required,
 #   Q34_why_not_moreP_cost_analysis,
 #   Q34_why_not_moreP_paddock_variability 
 # )
 # 
 # reason_soil_P
 # 
 # #text is too long
 # reason_soil_P 
 
 
 # The difficulty in being able to represent the variability in a paddock 
 
 
 # reason_soil_P <- mutate(
 #   reason_soil_P,
 #   names_display = case_when(
 #     reason == "The cost of soil sampling" ~ "cost",
 #     reason == "The level of accuracy of soil testing lab analysis" ~ "lab_accuracy",
 #     reason == "The ability to translate soil test results into a profitable fertiliser decision for my paddock" ~ "test_profit_decision",
 #     reason == "Not being able to get soil test results at the right time for decision making " ~ "right_time",
 #     reason == "The time required for soil sampling" ~ "time_required",
 #     reason == "The cost of soil testing lab analysis" ~ "cost_analysis",
 #     reason == "The difficulty in being able to represent the variability in a paddock" ~ "paddock_variability"
 #   )
 # )
 # reason_soil_P
 
 
 #### **Question 35** 
 # Agronomist
 # Grower
 # Please indicate if you agree/disagree with the following statements in relation to SOIL testing
 # * My farm business would be more profitable if I did more soil testing than I do now
 # * Uncertainty about how the season will turn out makes it hard to get value from soil testing results

 # overal responses including NA
 # data$Q_35.1
 # Q35.1_Farm_more_profit <- summary_stats_all_resp(data, quo(Resp_Group), quo(Q_35.1))
 # Q35.1_Farm_more_profit
 # Q35.2_Uncertain_return <- summary_stats_all_resp(data, quo(Resp_Group), quo(Q_35.2))
 # Q35.2_Uncertain_return
 # 
 # Q35_reason<- rbind(Q35.1_Farm_more_profit,  Q35.2_Uncertain_return)
 # Q35_reason
 
 ####{r q35 data prep, include=FALSE}
 
 data$Q_35.1
 data$Q_35.2
 #group the Q35 data together
 subsetQ35 <- select(data, Q_35.1, Q_35.2, Resp_Group) 
 #how many people na the questions
 subsetQ35
 
 grower_na <- subsetQ35 %>% 
   filter(Resp_Group == "Grower" ) %>% 
   select_if(function(Q_35.1) any(is.na(Q_35.1))) %>% 
   summarise_each(funs(sum(is.na(.)))) -> extra_NA
 
 agronomist_na <- subsetQ35 %>% 
   filter(Resp_Group == "Agronomist" ) %>% 
   select_if(function(Q_35.1) any(is.na(Q_35.1))) %>% 
   summarise_each(funs(sum(is.na(.)))) -> extra_NA
 
 Q35_ans_g <-as.vector(99 - grower_na[1,1], mode = 'numeric') 
 Q35_ans_a <- 71 - as.vector(agronomist_na[1,1], mode = 'numeric') 
 grower_na
 
 ##Q_35.1
 
 subsetQ35.1_summary <- subsetQ35 %>%
   filter(!is.na(Q_35.1)) %>% 
   group_by( Resp_Group, Q_35.1) %>%
   count(Q_35.1) 
 
 subsetQ35.1_summary <- subsetQ35.1_summary %>% 
   mutate(Resp_numb_for_question = case_when(
     Resp_Group == "Agronomist" ~ (71 - as.vector(agronomist_na[1,1], mode = 'numeric')),
     Resp_Group == "Grower"  ~  (99- as.vector(grower_na[1,1], mode = 'numeric')) ),
     percent_of_numb_resp = n/Resp_numb_for_question,
     question = "more profitable",
     scale = Q_35.1
   )
 
 subsetQ35.1_summary
 
 ##Q_35.2
 
 subsetQ35.2_summary <- subsetQ35 %>%
   filter(!is.na(Q_35.2)) %>% 
   group_by( Resp_Group, Q_35.2) %>%
   count(Q_35.2) 
 
 subsetQ35.2_summary <- subsetQ35.2_summary %>% 
   mutate(Resp_numb_for_question = case_when(
     Resp_Group == "Agronomist" ~ (71 - as.vector(agronomist_na[1,2], mode = 'numeric')),
     Resp_Group == "Grower"  ~  (99- as.vector(grower_na[1,2], mode = 'numeric')) ),
     percent_of_numb_resp = n/Resp_numb_for_question,
     question = "Uncertainty",
     scale = Q_35.2
   )
 
 subsetQ35.2_summary
 
 subsetQ35_summary <- rbind(subsetQ35.1_summary,
                            subsetQ35.2_summary)
 
 subsetQ35_summary <- select(subsetQ35_summary,
                             Resp_Group,
                             n,
                             Resp_numb_for_question,
                             percent_of_numb_resp,
                             question,scale)
 subsetQ35_summary
 
 
 ##```
 
 ##```{r Q35 graph, echo=FALSE}
 # df needs ording for display
 subsetQ35_summary$scale <-
   factor(
     subsetQ35_summary$scale ,
     levels = c(
       "Strongly agree",
       "Agree",
       "Neutral",
       "Disagree")
 )

 unique(subsetQ35_summary$scale)
 
 ###NOTE incorrect order on x scale?
 
 ggplot(subsetQ35_summary, aes (x =  reorder(scale, -percent_of_numb_resp), y = percent_of_numb_resp, 
                                fill = Resp_Group))+
   geom_col()+
   scale_fill_manual(values=c("grey70", "grey40"))+
   facet_wrap(question~ Resp_Group )+
   theme_classic()+
   labs(x= "",
        y = "",
        title = "",
        subtitle = "",
        caption = "Q)  Please indicate if you agree/disagree with, more profitable & Uncertainty in relation to SOIL testing")+
   theme(axis.text.x=element_text(angle=90,hjust=1),
         plot.caption = element_text(size = 8), legend.position = "none") +
   scale_y_continuous(labels = scales::percent_format(accuracy = 5L)) 
 
 
 
 
 # #### **Question 36** 
 # Agronomist
 # Grower
 # Please indicate why you don't do any PLANT testing
 # 
 # * The cost of plant sampling
 # * The time required for plant sampling
 # * The cost of plant analysis
 # * The difficulty in being able to represent the variability in a paddock55
 # * The level of accuracy of plant analysis
 # * The ability to translate plant test results into a profitable fertiliser decision for my paddock
 # * Not being able to get plant test results at the right time for decision making
 # * Comment
 # reason == "The cost of soil sampling" ~ "cost",
 # reason == "The time required for soil sampling" ~ "time",
 # reason == "The cost of soil testing lab analysis" ~ "cost of lab analysis",
 # reason == "The difficulty in being able to represent the variability in a paddock" ~ "variability",
 # reason == "The level of accuracy of soil testing lab analysis" ~ "accuracy",
 # reason == "The ability to translate soil test results into a profitable fertiliser decision for my paddock" ~ "translate profitable decision",
 # reason == "Not being able to get soil test results at the right time for decision making" ~ "get results at right time"
 # )
 data$Q_36.1
  Q36_why_not_morePlant_cost <- summary_stats_all_resp(data, quo(Resp_Group), quo(Q_36.1))
 
  data$Q_36.1
  #group the Q35 data together
  subsetQ36 <- select(data, Q_36.1, Q_36.2, Q_36.3, Q_36.4, Q_36.5, Q_36.6, Q_36.7, Q_36.8, Resp_Group) 
  #how many people na the questions
  subsetQ36
  
  grower_na <- subsetQ36 %>% 
    filter(Resp_Group == "Grower" ) %>% 
    select_if(function(Q_36.1) any(is.na(Q_36.1))) %>% 
    summarise_each(funs(sum(is.na(.)))) -> extra_NA
  
  agronomist_na <- subsetQ36 %>% 
    filter(Resp_Group == "Agronomist" ) %>% 
    select_if(function(Q_36.1) any(is.na(Q_36.1))) %>% 
    summarise_each(funs(sum(is.na(.)))) -> extra_NA
  
  Q36_ans_g <-as.vector(99 - grower_na[1,1], mode = 'numeric') 
  Q36_ans_a <- 71 - as.vector(agronomist_na[1,1], mode = 'numeric') 
  grower_na
  
  ##Q_36.1
  
  subsetQ36.1_summary <- subsetQ36 %>%
    filter(!is.na(Q_36.1)) %>% 
    group_by( Resp_Group, Q_36.1) %>%
    count(Q_36.1) 
  
  subsetQ36.1_summary <- subsetQ36.1_summary %>% 
    mutate(Resp_numb_for_question = case_when(
      Resp_Group == "Agronomist" ~ (71 - as.vector(agronomist_na[1,1], mode = 'numeric')),
      Resp_Group == "Grower"  ~  (99- as.vector(grower_na[1,1], mode = 'numeric')) ),
      percent_of_numb_resp = n/Resp_numb_for_question,
      question = "cost",
      scale = Q_36.1
    )
  
  subsetQ36.1_summary
  
  ##Q_36.2
  
  subsetQ36.2_summary <- subsetQ36 %>%
    filter(!is.na(Q_36.2)) %>% 
    group_by( Resp_Group, Q_36.2) %>%
    count(Q_36.2) 
  
  subsetQ36.2_summary <- subsetQ36.2_summary %>% 
    mutate(Resp_numb_for_question = case_when(
      Resp_Group == "Agronomist" ~ (71 - as.vector(agronomist_na[1,2], mode = 'numeric')),
      Resp_Group == "Grower"  ~  (99- as.vector(grower_na[1,2], mode = 'numeric')) ),
      percent_of_numb_resp = n/Resp_numb_for_question,
      question = "time",
      scale = Q_36.2
    )
  
  subsetQ36.2_summary
  
  ##Q_36.3
  
  subsetQ36.3_summary <- subsetQ36 %>%
    filter(!is.na(Q_36.3)) %>% 
    group_by( Resp_Group, Q_36.3) %>%
    count(Q_36.3) 
  
  subsetQ36.3_summary <- subsetQ36.3_summary %>% 
    mutate(Resp_numb_for_question = case_when(
      Resp_Group == "Agronomist" ~ (71 - as.vector(agronomist_na[1,2], mode = 'numeric')),
      Resp_Group == "Grower"  ~  (99- as.vector(grower_na[1,2], mode = 'numeric')) ),
      percent_of_numb_resp = n/Resp_numb_for_question,
      question = "cost of lab analysis",
      scale = Q_36.3
    )
  subsetQ36.3_summary
  
  ##Q_36.4
  
  subsetQ36.4_summary <- subsetQ36 %>%
    filter(!is.na(Q_36.4)) %>% 
    group_by( Resp_Group, Q_36.4) %>%
    count(Q_36.4) 
  
  subsetQ36.4_summary <- subsetQ36.4_summary %>% 
    mutate(Resp_numb_for_question = case_when(
      Resp_Group == "Agronomist" ~ (71 - as.vector(agronomist_na[1,2], mode = 'numeric')),
      Resp_Group == "Grower"  ~  (99- as.vector(grower_na[1,2], mode = 'numeric')) ),
      percent_of_numb_resp = n/Resp_numb_for_question,
      question = "variability",
      scale = Q_36.4
    )
  subsetQ36.4_summary
  
  ##Q_36.5
  
  subsetQ36.5_summary <- subsetQ36 %>%
    filter(!is.na(Q_36.5)) %>% 
    group_by( Resp_Group, Q_36.5) %>%
    count(Q_36.5) 
  
  subsetQ36.5_summary <- subsetQ36.5_summary %>% 
    mutate(Resp_numb_for_question = case_when(
      Resp_Group == "Agronomist" ~ (71 - as.vector(agronomist_na[1,2], mode = 'numeric')),
      Resp_Group == "Grower"  ~  (99- as.vector(grower_na[1,2], mode = 'numeric')) ),
      percent_of_numb_resp = n/Resp_numb_for_question,
      question = "accuracy",
      scale = Q_36.5
    )
  subsetQ36.5_summary
  
  ##Q_36.6
  
  subsetQ36.6_summary <- subsetQ36 %>%
    filter(!is.na(Q_36.6)) %>% 
    group_by( Resp_Group, Q_36.6) %>%
    count(Q_36.6) 
  
  subsetQ36.6_summary <- subsetQ36.6_summary %>% 
    mutate(Resp_numb_for_question = case_when(
      Resp_Group == "Agronomist" ~ (71 - as.vector(agronomist_na[1,2], mode = 'numeric')),
      Resp_Group == "Grower"  ~  (99- as.vector(grower_na[1,2], mode = 'numeric')) ),
      percent_of_numb_resp = n/Resp_numb_for_question,
      question = "translate profitable decision",
      scale = Q_36.6
    )
  subsetQ36.6_summary
  
  ##Q_36.7
  
  subsetQ36.7_summary <- subsetQ36 %>%
    filter(!is.na(Q_36.7)) %>% 
    group_by( Resp_Group, Q_36.7) %>%
    count(Q_36.7) 
  
  subsetQ36.7_summary <- subsetQ36.7_summary %>% 
    mutate(Resp_numb_for_question = case_when(
      Resp_Group == "Agronomist" ~ (71 - as.vector(agronomist_na[1,2], mode = 'numeric')),
      Resp_Group == "Grower"  ~  (99- as.vector(grower_na[1,2], mode = 'numeric')) ),
      percent_of_numb_resp = n/Resp_numb_for_question,
      question = "get results at right time",
      scale = Q_36.7
    )
  subsetQ36.7_summary
  
  
  subsetQ36_summary <- rbind(subsetQ36.1_summary,
                             subsetQ36.2_summary,
                             subsetQ36.3_summary,
                             subsetQ36.4_summary,
                             subsetQ36.5_summary,
                             subsetQ36.6_summary,
                             subsetQ36.7_summary)
                            
  
  subsetQ36_summary <- select(subsetQ36_summary,
                              Resp_Group,
                              n,
                              Resp_numb_for_question,
                              percent_of_numb_resp,
                              question,scale)
  subsetQ36_summary
  
  
  ##```
  
  ##```{r Q36 graph, echo=FALSE}
  # df needs ording for display
  subsetQ36_summary$scale <-
    factor(
      subsetQ36_summary$scale ,
      levels = c(
        "Strongly agree",
        "Agree",
        "Neutral",
        "Disagree")
    )
  
  unique(subsetQ36_summary$scale)
  
  ###NOTE incorrect order on x scale?
  ggplot(subsetQ36_summary, aes (x =  reorder(scale, -percent_of_numb_resp), y = percent_of_numb_resp, 
                                 fill = Resp_Group))+
    geom_col()+
    scale_fill_manual(values=c("grey70", "grey40"))+
    facet_wrap(question~ Resp_Group )+
    theme_classic()+
    labs(x= "",
         y = "",
         title = "",
         subtitle = "",
         caption = "Q) Please indicate why you don't do any PLANT testing?")+
    theme(axis.text.x=element_text(angle=90,hjust=1),
          plot.caption = element_text(size = 8), legend.position = "none") +
    scale_y_continuous(labels = scales::percent_format(accuracy = 5L)) 
  
  
 
 # #### **Question 37**
 # Agronomist
 # Please indicate if you agree/disagree with the following statements in relation to PLANT testing
 # 
 # * My clients businesses would be more profitable if they did more plant testing than they do now
 # * Uncertainty about how the season will turn out makes it hard to get value from plant testing results
 # * Feel free to comment on this response
 # 
 # Grower
 # Please indicate if you agree/disagree with the following statements in relation to  PLANT testing
 # * My farm business would be more profitable if I did more plant testing than I do now
 # * Uncertainty about how the season will turn out makes it hard to get value from plant testing results
 # 
 # ####{r q37 data prep, include=FALSE}
  
  data$Q_37.1
  data$Q_37.2
  #group the Q35 data together
  subsetQ37 <- select(data, Q_37.1, Q_37.2, Resp_Group) 
  #how many people na the questions
  subsetQ37
  
  grower_na <- subsetQ37 %>% 
    filter(Resp_Group == "Grower" ) %>% 
    select_if(function(Q_37.1) any(is.na(Q_37.1))) %>% 
    summarise_each(funs(sum(is.na(.)))) -> extra_NA
  
  agronomist_na <- subsetQ37 %>% 
    filter(Resp_Group == "Agronomist" ) %>% 
    select_if(function(Q_37.1) any(is.na(Q_37.1))) %>% 
    summarise_each(funs(sum(is.na(.)))) -> extra_NA
  
  Q37_ans_g <-as.vector(99 - grower_na[1,1], mode = 'numeric') 
  Q37_ans_a <- 71 - as.vector(agronomist_na[1,1], mode = 'numeric') 
  grower_na
  agronomist_na
  
  ##Q_37.1
  
  subsetQ37.1_summary <- subsetQ37 %>%
    filter(!is.na(Q_37.1)) %>% 
    group_by( Resp_Group, Q_37.1) %>%
    count(Q_37.1) 
  
  subsetQ37.1_summary <- subsetQ37.1_summary %>% 
    mutate(Resp_numb_for_question = case_when(
      Resp_Group == "Agronomist" ~ (71 - as.vector(agronomist_na[1,1], mode = 'numeric')),
      Resp_Group == "Grower"  ~  (99- as.vector(grower_na[1,1], mode = 'numeric')) ),
      percent_of_numb_resp = n/Resp_numb_for_question,
      question = "more profitable",
      scale = Q_37.1
    )
  
  subsetQ37.1_summary
  
  ##Q_37.2
  
  subsetQ37.2_summary <- subsetQ37 %>%
    filter(!is.na(Q_37.2)) %>% 
    group_by( Resp_Group, Q_37.2) %>%
    count(Q_37.2) 
  
  subsetQ37.2_summary <- subsetQ37.2_summary %>% 
    mutate(Resp_numb_for_question = case_when(
      Resp_Group == "Agronomist" ~ (71 - as.vector(agronomist_na[1,2], mode = 'numeric')),
      Resp_Group == "Grower"  ~  (99- as.vector(grower_na[1,2], mode = 'numeric')) ),
      percent_of_numb_resp = n/Resp_numb_for_question,
      question = "Uncertainty",
      scale = Q_37.2
    )
  
  subsetQ37.2_summary
  
  subsetQ37_summary <- rbind(subsetQ37.1_summary,
                             subsetQ37.2_summary)
  
  subsetQ37_summary <- select(subsetQ37_summary,
                              Resp_Group,
                              n,
                              Resp_numb_for_question,
                              percent_of_numb_resp,
                              question,scale)
  subsetQ37_summary
  
  
  ##```
  
  ##```{r Q37 graph, echo=FALSE}
  # df needs ording for display
  subsetQ37_summary$scale <-
    factor(
      subsetQ37_summary$scale ,
      levels = c(
        "Strongly agree",
        "Agree",
        "Neutral",
        "Disagree")
    )
  
  unique(subsetQ37_summary$scale)
  
  ###NOTE incorrect order on x scale?
  
  ggplot(subsetQ37_summary, aes (x =  reorder(scale, -percent_of_numb_resp), y = percent_of_numb_resp, 
                                 fill = Resp_Group))+
    geom_col()+
    scale_fill_manual(values=c("grey70", "grey40"))+
    facet_wrap(question~ Resp_Group )+
    theme_classic()+
    labs(x= "",
         y = "",
         title = "",
         subtitle = "",
         caption = "Q)  Please indicate if you agree/disagree with, more profitable & Uncertainty in relation to PLANT testing")+
    theme(axis.text.x=element_text(angle=90,hjust=1),
          plot.caption = element_text(size = 8), legend.position = "none") +
    scale_y_continuous(labels = scales::percent_format(accuracy = 5L)) 
  
  
 # 
 # 
 # #### **Question 38** 
 # What are the barriers to you undertaking...?
 #   
 #   * Soil testing? - Sampling cost
 # * Soil testing? - Analysis cost
 # * Soil testing? - Sampling time
 # * Soil testing? - Analysis time
 # * Soil testing? - Understanding / interpreting results
 # * Soil testing? - Sampling method
 # * Plant testing? - Sampling cost
 # * Plant testing? - Analysis cost
 # * Plant testing? - Sampling time
 # * Plant testing? - Analysis time
 # * Plant testing? - Understanding / interpreting results
 # * Plant testing? - Sampling method
 # * Other (please specify)

  
```







#### **Question 40**
Please feel free to add any other comments or suggestions

#### **Question 41**
Grower
What information do you require to make better informed decisions regarding nutrient management?

#### **Question 42**
Grower
Where and how would you like to receive information regarding crop nutrition?

* Rural newspapers
* Farm consultants
* Workshops
* Merchandise companies
* Government agencies
* Field days
* Brochures / booklets
* Local trials
* Fertilizer company information, e.g. fact sheets
* Soil or plant testing companies
* Researchers
* Google
* Social media
* Other (please specify)


#### **Question 44**
How do you think researchers or the GRDC could assist you to get a better return on investment for your fertiliser decisions?


#### **Question 45**
Please feel free to add any other comments or suggestions



